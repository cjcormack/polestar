if(!Array.prototype.map)Array.prototype.map=function(e,t){var n=this.length;var r=new Array(n);for(var i=0;i<n;i++){if(i in this){r[i]=e.call(t,this[i],i,this)}}return r};if(!Array.prototype.filter)Array.prototype.filter=function(e,t){var n=this.length;var r=new Array;for(var i=0;i<n;i++){if(i in this){var s=this[i];if(e.call(t,s,i,this))r.push(s)}}return r};if(!Array.prototype.forEach)Array.prototype.forEach=function(e,t){var n=this.length>>>0;for(var r=0;r<n;r++){if(r in this)e.call(t,this[r],r,this)}};if(!Array.prototype.reduce)Array.prototype.reduce=function(e,t){var n=this.length;if(!n&&arguments.length==1){throw new Error("reduce: empty array, no initial value")}var r=0;if(arguments.length<2){while(true){if(r in this){t=this[r++];break}if(++r>=n){throw new Error("reduce: no values, no initial value")}}}for(;r<n;r++){if(r in this){t=e(t,this[r],r,this)}}return t};var pv={};pv.version="3.3.1";pv.identity=function(e){return e};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};pv.extend=function(e){function t(){}t.prototype=e.prototype||e;return new t};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(e){var t=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),n,r,i=0,s="";while(n=t.exec(e)){var o=n.index+n[0].length;if(e.charAt(o)!="{"){s+=e.substring(i,o)+"{return ";i=o;for(var u=0;u>=0&&o<e.length;o++){var a=e.charAt(o);switch(a){case'"':case"'":{while(++o<e.length&&(r=e.charAt(o))!=a){if(r=="\\")o++}break};case"[":case"(":u++;break;case"]":case")":u--;break;case";":case",":if(u==0)u--;break}}s+=pv.parse(e.substring(i,--o))+";}";i=o}t.lastIndex=o}s+=e.substring(i);return s}}pv.css=function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]};pv.error=function(e){typeof console=="undefined"?alert(e):console.error(e)};pv.listen=function(e,t,n){n=pv.listener(n);return e.addEventListener?e.addEventListener(t,n,false):e.attachEvent("on"+t,n)};pv.listener=function(e){return e.$listener||(e.$listener=function(t){try{pv.event=t;return e.call(this,t)}finally{delete pv.event}})};pv.ancestor=function(e,t){while(t){if(t==e)return true;t=t.parentNode}return false};pv.id=function(){var e=1;return function(){return e++}}();pv.functor=function(e){return typeof e=="function"?e:function(){return e}};pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};for(;pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text))}catch(e){pv.error(e)}}}delete pv.$});pv.Format={};pv.Format.re=function(e){return e.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(e,t,n){var r=t-String(n).length;return r<1?n:(new Array(r+1)).join(e)+n};pv.Format.date=function(e){function n(n){return e.replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()];case"%c":return n.toLocaleString();case"%C":return t("0",2,Math.floor(n.getFullYear()/100)%100);case"%d":return t("0",2,n.getDate());case"%x":case"%D":return t("0",2,n.getMonth()+1)+"/"+t("0",2,n.getDate())+"/"+t("0",2,n.getFullYear()%100);case"%e":return t(" ",2,n.getDate());case"%H":return t("0",2,n.getHours());case"%I":{var r=n.getHours()%12;return r?t("0",2,r):12};case"%m":return t("0",2,n.getMonth()+1);case"%M":return t("0",2,n.getMinutes());case"%n":return"\n";case"%p":return n.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":{var r=n.getHours()%12;return(r?t("0",2,r):12)+":"+t("0",2,n.getMinutes())+":"+t("0",2,n.getSeconds())+" "+(n.getHours()<12?"AM":"PM")};case"%R":return t("0",2,n.getHours())+":"+t("0",2,n.getMinutes());case"%S":return t("0",2,n.getSeconds());case"%Q":return t("0",3,n.getMilliseconds());case"%t":return"	";case"%u":{var i=n.getDay();return i?i:1};case"%w":return n.getDay();case"%y":return t("0",2,n.getFullYear()%100);case"%Y":return n.getFullYear();case"%%":return"%"}return e})}var t=pv.Format.pad;n.format=n;n.parse=function(t){var n=1970,r=0,i=1,s=0,o=0,u=0;var a=[function(){}];var f=pv.Format.re(e).replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%b":{a.push(function(e){r={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[e]});return"([A-Za-z]+)"};case"%h":case"%B":{a.push(function(e){r={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[e]});return"([A-Za-z]+)"};case"%e":case"%d":{a.push(function(e){i=e});return"([0-9]+)"};case"%I":case"%H":{a.push(function(e){s=e});return"([0-9]+)"};case"%m":{a.push(function(e){r=e-1});return"([0-9]+)"};case"%M":{a.push(function(e){o=e});return"([0-9]+)"};case"%p":{a.push(function(e){if(s==12){if(e=="am")s=0}else if(e=="pm"){s=Number(s)+12}});return"(am|pm)"};case"%S":{a.push(function(e){u=e});return"([0-9]+)"};case"%y":{a.push(function(e){e=Number(e);n=e+(0<=e&&e<69?2e3:e>=69&&e<100?1900:0)});return"([0-9]+)"};case"%Y":{a.push(function(e){n=e});return"([0-9]+)"};case"%%":{a.push(function(){});return"%"}}return e});var l=t.match(f);if(l)l.forEach(function(e,t){a[t](e)});return new Date(n,r,i,s,o,u)};return n};pv.Format.time=function(e){function n(n){n=Number(n);switch(e){case"short":{if(n>=31536e6){return(n/31536e6).toFixed(1)+" years"}else if(n>=6048e5){return(n/6048e5).toFixed(1)+" weeks"}else if(n>=864e5){return(n/864e5).toFixed(1)+" days"}else if(n>=36e5){return(n/36e5).toFixed(1)+" hours"}else if(n>=6e4){return(n/6e4).toFixed(1)+" minutes"}return(n/1e3).toFixed(1)+" seconds"};case"long":{var r=[],i=n%6e4/1e3>>0,s=n%36e5/6e4>>0;r.push(t("0",2,i));if(n>=36e5){var o=n%864e5/36e5>>0;r.push(t("0",2,s));if(n>=864e5){r.push(t("0",2,o));r.push(Math.floor(n/864e5).toFixed())}else{r.push(o.toFixed())}}else{r.push(s.toFixed())}return r.reverse().join(":")}}}var t=pv.Format.pad;n.format=n;n.parse=function(t){switch(e){case"short":{var n=/([0-9,.]+)\s*([a-z]+)/g,r,i=0;while(r=n.exec(t)){var s=parseFloat(r[0].replace(",","")),o=0;switch(r[2].toLowerCase()){case"year":case"years":o=31536e6;break;case"week":case"weeks":o=6048e5;break;case"day":case"days":o=864e5;break;case"hour":case"hours":o=36e5;break;case"minute":case"minutes":o=6e4;break;case"second":case"seconds":o=1e3;break}i+=s*o}return i};case"long":{var r=t.replace(",","").split(":").reverse(),i=0;if(r.length)i+=parseFloat(r[0])*1e3;if(r.length>1)i+=parseFloat(r[1])*6e4;if(r.length>2)i+=parseFloat(r[2])*36e5;if(r.length>3)i+=parseFloat(r[3])*864e5;return i}}};return n};pv.Format.number=function(){function p(p){if(Infinity>i)p=Math.round(p*s)/s;var d=String(Math.abs(p)).split(".");var v=d[0];if(v.length>t)v=v.substring(v.length-t);if(a&&v.length<e)v=(new Array(e-v.length+1)).join(o)+v;if(v.length>3)v=v.replace(/\B(?=(?:\d{3})+(?!\d))/g,l);if(!a&&v.length<n)v=(new Array(n-v.length+1)).join(o)+v;d[0]=p<0?c+v+h:v;var m=d[1]||"";if(m.length<r)d[1]=m+(new Array(r-m.length+1)).join(u);return d.join(f)}var e=0,t=Infinity,n=0,r=0,i=0,s=1,o="0",u="0",a=true,f=".",l=",",c="âˆ’",h="";p.format=p;p.parse=function(e){var n=pv.Format.re;var r=String(e).replace(new RegExp("^("+n(o)+")*"),"").replace(new RegExp("("+n(u)+")*$"),"").split(f);var a=r[0].replace(new RegExp(n(l),"g"),"");if(a.length>t)a=a.substring(a.length-t);var c=r[1]?Number("0."+r[1]):0;if(Infinity>i)c=Math.round(c*s)/s;return Math.round(a)+c};p.integerDigits=function(r,i){if(arguments.length){e=Number(r);t=arguments.length>1?Number(i):e;n=e+Math.floor(e/3)*l.length;return this}return[e,t]};p.fractionDigits=function(e,t){if(arguments.length){r=Number(e);i=arguments.length>1?Number(t):r;s=Math.pow(10,i);return this}return[r,i]};p.integerPad=function(e){if(arguments.length){o=String(e);a=/\d/.test(o);return this}return o};p.fractionPad=function(e){if(arguments.length){u=String(e);return this}return u};p.decimal=function(e){if(arguments.length){f=String(e);return this}return f};p.group=function(t){if(arguments.length){l=t?String(t):"";n=e+Math.floor(e/3)*l.length;return this}return l};p.negativeAffix=function(e,t){if(arguments.length){c=String(e||"");h=String(t||"");return this}return[c,h]};return p};pv.map=function(e,t){var n={};return t?e.map(function(e,r){n.index=r;return t.call(n,e)}):e.slice()};pv.repeat=function(e,t){if(arguments.length==1)t=2;return pv.blend(pv.range(t).map(function(){return e}))};pv.cross=function(e,t){var n=[];for(var r=0,i=e.length,s=t.length;r<i;r++){for(var o=0,u=e[r];o<s;o++){n.push([u,t[o]])}}return n};pv.blend=function(e){return Array.prototype.concat.apply([],e)};pv.transpose=function(e){var t=e.length,n=pv.max(e,function(e){return e.length});if(n>t){e.length=n;for(var r=t;r<n;r++){e[r]=new Array(t)}for(var r=0;r<t;r++){for(var i=r+1;i<n;i++){var s=e[r][i];e[r][i]=e[i][r];e[i][r]=s}}}else{for(var r=0;r<n;r++){e[r].length=t}for(var r=0;r<t;r++){for(var i=0;i<r;i++){var s=e[r][i];e[r][i]=e[i][r];e[i][r]=s}}}e.length=n;for(var r=0;r<n;r++){e[r].length=t}return e};pv.normalize=function(e,t){var n=pv.map(e,t),r=pv.sum(n);for(var i=0;i<n.length;i++)n[i]/=r;return n};pv.permute=function(e,t,n){if(!n)n=pv.identity;var r=new Array(t.length),i={};t.forEach(function(t,s){i.index=t;r[s]=n.call(i,e[t])});return r};pv.numerate=function(e,t){if(!t)t=pv.identity;var n={},r={};e.forEach(function(e,i){r.index=i;n[t.call(r,e)]=i});return n};pv.uniq=function(e,t){if(!t)t=pv.identity;var n={},r=[],i={},s;e.forEach(function(e,u){i.index=u;s=t.call(i,e);if(!(s in n))n[s]=r.push(s)});return r};pv.naturalOrder=function(e,t){return e<t?-1:e>t?1:0};pv.reverseOrder=function(e,t){return t<e?-1:t>e?1:0};pv.search=function(e,t,n){if(!n)n=pv.identity;var r=0,i=e.length-1;while(r<=i){var s=r+i>>1,o=n(e[s]);if(o<t)r=s+1;else if(o>t)i=s-1;else return s}return-r-1};pv.search.index=function(e,t,n){var r=pv.search(e,t,n);return r<0?-r-1:r};pv.range=function(e,t,n){if(arguments.length==1){t=e;e=0}if(n==undefined)n=1;if((t-e)/n==Infinity)throw new Error("range must be finite");var r=[],i=0,s;t-=(t-e)*1e-10;if(n<0){while((s=e+n*i++)>t){r.push(s)}}else{while((s=e+n*i++)<t){r.push(s)}}return r};pv.random=function(e,t,n){if(arguments.length==1){t=e;e=0}if(n==undefined)n=1;return n?Math.floor(Math.random()*(t-e)/n)*n+e:Math.random()*(t-e)+e};pv.sum=function(e,t){var n={};return e.reduce(t?function(e,r,i){n.index=i;return e+t.call(n,r)}:function(e,t){return e+t},0)};pv.max=function(e,t){if(t==pv.index)return e.length-1;return Math.max.apply(null,t?pv.map(e,t):e)};pv.max.index=function(e,t){if(!e.length)return-1;if(t==pv.index)return e.length-1;if(!t)t=pv.identity;var n=0,r=-Infinity,i={};for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s]);if(o>r){r=o;n=s}}return n};pv.min=function(e,t){if(t==pv.index)return 0;return Math.min.apply(null,t?pv.map(e,t):e)};pv.min.index=function(e,t){if(!e.length)return-1;if(t==pv.index)return 0;if(!t)t=pv.identity;var n=0,r=Infinity,i={};for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s]);if(o<r){r=o;n=s}}return n};pv.mean=function(e,t){return pv.sum(e,t)/e.length};pv.median=function(e,t){if(t==pv.index)return(e.length-1)/2;e=pv.map(e,t).sort(pv.naturalOrder);if(e.length%2)return e[Math.floor(e.length/2)];var n=e.length/2;return(e[n-1]+e[n])/2};pv.variance=function(e,t){if(e.length<1)return NaN;if(e.length==1)return 0;var n=pv.mean(e,t),r=0,i={};if(!t)t=pv.identity;for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s])-n;r+=o*o}return r};pv.deviation=function(e,t){return Math.sqrt(pv.variance(e,t)/(e.length-1))};pv.log=function(e,t){return Math.log(e)/Math.log(t)};pv.logSymmetric=function(e,t){return e==0?0:e<0?-pv.log(-e,t):pv.log(e,t)};pv.logAdjusted=function(e,t){if(!isFinite(e))return e;var n=e<0;if(e<t)e+=(t-e)/t;return n?-pv.log(e,t):pv.log(e,t)};pv.logFloor=function(e,t){return e>0?Math.pow(t,Math.floor(pv.log(e,t))):-Math.pow(t,-Math.floor(-pv.log(-e,t)))};pv.logCeil=function(e,t){return e>0?Math.pow(t,Math.ceil(pv.log(e,t))):-Math.pow(t,-Math.ceil(-pv.log(-e,t)))};(function(){var e=Math.PI/180,t=180/Math.PI;pv.radians=function(t){return e*t};pv.degrees=function(e){return t*e}})();pv.keys=function(e){var t=[];for(var n in e){t.push(n)}return t};pv.entries=function(e){var t=[];for(var n in e){t.push({key:n,value:e[n]})}return t};pv.values=function(e){var t=[];for(var n in e){t.push(e[n])}return t};pv.dict=function(e,t){var n={},r={};for(var i=0;i<e.length;i++){if(i in e){var s=e[i];r.index=i;n[s]=t.call(r,s)}}return n};pv.dom=function(e){return new pv.Dom(e)};pv.Dom=function(e){this.$map=e};pv.Dom.prototype.$leaf=function(e){return typeof e!="object"};pv.Dom.prototype.leaf=function(e){if(arguments.length){this.$leaf=e;return this}return this.$leaf};pv.Dom.prototype.root=function(e){function r(e){var n=new pv.Dom.Node;for(var i in e){var s=e[i];n.appendChild(t(s)?new pv.Dom.Node(s):r(s)).nodeName=i}return n}var t=this.$leaf,n=r(this.$map);n.nodeName=e;return n};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(e){this.nodeValue=e;this.childNodes=[]};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);if(t==-1)throw new Error("child not found");this.childNodes.splice(t,1);if(e.previousSibling)e.previousSibling.nextSibling=e.nextSibling;else this.firstChild=e.nextSibling;if(e.nextSibling)e.nextSibling.previousSibling=e.previousSibling;else this.lastChild=e.previousSibling;delete e.nextSibling;delete e.previousSibling;delete e.parentNode;return e};pv.Dom.Node.prototype.appendChild=function(e){if(e.parentNode)e.parentNode.removeChild(e);e.parentNode=this;e.previousSibling=this.lastChild;if(this.lastChild)this.lastChild.nextSibling=e;else this.firstChild=e;this.lastChild=e;this.childNodes.push(e);return e};pv.Dom.Node.prototype.insertBefore=function(e,t){if(!t)return this.appendChild(e);var n=this.childNodes.indexOf(t);if(n==-1)throw new Error("child not found");if(e.parentNode)e.parentNode.removeChild(e);e.parentNode=this;e.nextSibling=t;e.previousSibling=t.previousSibling;if(t.previousSibling){t.previousSibling.nextSibling=e}else{if(t==this.lastChild)this.lastChild=e;this.firstChild=e}this.childNodes.splice(n,0,e);return e};pv.Dom.Node.prototype.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);if(n==-1)throw new Error("child not found");if(e.parentNode)e.parentNode.removeChild(e);e.parentNode=this;e.nextSibling=t.nextSibling;e.previousSibling=t.previousSibling;if(t.previousSibling)t.previousSibling.nextSibling=e;else this.firstChild=e;if(t.nextSibling)t.nextSibling.previousSibling=e;else this.lastChild=e;this.childNodes[n]=e;return t};pv.Dom.Node.prototype.visitBefore=function(e){function t(n,r){e(n,r);for(var i=n.firstChild;i;i=i.nextSibling){t(i,r+1)}}t(this,0)};pv.Dom.Node.prototype.visitAfter=function(e){function t(n,r){for(var i=n.firstChild;i;i=i.nextSibling){t(i,r+1)}e(n,r)}t(this,0)};pv.Dom.Node.prototype.sort=function(e){if(this.firstChild){this.childNodes.sort(e);var t=this.firstChild=this.childNodes[0],n;delete t.previousSibling;for(var r=1;r<this.childNodes.length;r++){t.sort(e);n=this.childNodes[r];n.previousSibling=t;t=t.nextSibling=n}this.lastChild=t;delete t.nextSibling;t.sort(e)}return this};pv.Dom.Node.prototype.reverse=function(){var e=[];this.visitAfter(function(t){while(t.lastChild)e.push(t.removeChild(t.lastChild));for(var n;n=e.pop();)t.insertBefore(n,t.firstChild)});return this};pv.Dom.Node.prototype.nodes=function(){function t(n){e.push(n);n.childNodes.forEach(t)}var e=[];t(this,e);return e};pv.Dom.Node.prototype.toggle=function(e){if(e)return this.toggled?this.visitBefore(function(e){if(e.toggled)e.toggle()}):this.visitAfter(function(e){if(!e.toggled)e.toggle()});var t=this;if(t.toggled){for(var n;n=t.toggled.pop();)t.appendChild(n);delete t.toggled}else if(t.lastChild){t.toggled=[];while(t.lastChild)t.toggled.push(t.removeChild(t.lastChild))}};pv.nodes=function(e){var t=new pv.Dom.Node;for(var n=0;n<e.length;n++){t.appendChild(new pv.Dom.Node(e[n]))}return t.nodes()};pv.tree=function(e){return new pv.Tree(e)};pv.Tree=function(e){this.array=e};pv.Tree.prototype.keys=function(e){this.k=e;return this};pv.Tree.prototype.value=function(e){this.v=e;return this};pv.Tree.prototype.map=function(){var e={},t={};for(var n=0;n<this.array.length;n++){t.index=n;var r=this.array[n],i=this.k.call(t,r),s=e;for(var o=0;o<i.length-1;o++){s=s[i[o]]||(s[i[o]]={})}s[i[o]]=this.v?this.v.call(t,r):r}return e};pv.nest=function(e){return new pv.Nest(e)};pv.Nest=function(e){this.array=e;this.keys=[]};pv.Nest.prototype.key=function(e){this.keys.push(e);return this};pv.Nest.prototype.sortKeys=function(e){this.keys[this.keys.length-1].order=e||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(e){this.order=e||pv.naturalOrder;return this};pv.Nest.prototype.map=function(){var e={},t=[];for(var n,r=0;r<this.array.length;r++){var i=this.array[r];var s=e;for(n=0;n<this.keys.length-1;n++){var o=this.keys[n](i);if(!s[o])s[o]={};s=s[o]}o=this.keys[n](i);if(!s[o]){var u=[];t.push(u);s[o]=u}s[o].push(i)}if(this.order){for(var n=0;n<t.length;n++){t[n].sort(this.order)}}return e};pv.Nest.prototype.entries=function(){function e(t){var n=[];for(var r in t){var i=t[r];n.push({key:r,values:i instanceof Array?i:e(i)})}return n}function t(e,n){var r=this.keys[n].order;if(r)e.sort(function(e,t){return r(e.key,t.key)});if(++n<this.keys.length){for(var i=0;i<e.length;i++){t.call(this,e[i].values,n)}}return e}return t.call(this,e(this.map()),0)};pv.Nest.prototype.rollup=function(e){function t(n){for(var r in n){var i=n[r];if(i instanceof Array){n[r]=e(i)}else{t(i)}}return n}return t(this.map())};pv.flatten=function(e){return new pv.Flatten(e)};pv.Flatten=function(e){this.map=e;this.keys=[]};pv.Flatten.prototype.key=function(e,t){this.keys.push({name:e,value:t});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(e){this.keys.length=0;this.$leaf=e;return this};pv.Flatten.prototype.array=function(){function s(r,i){if(i<n.length-1){for(var o in r){t.push(o);s(r[o],i+1);t.pop()}}else{e.push(t.concat(r))}}var e=[],t=[],n=this.keys,r=this.$leaf;if(r){function i(n,s){if(r(n)){e.push({keys:t.slice(),value:n})}else{for(var o in n){t.push(o);i(n[o],s+1);t.pop()}}}i(this.map,0);return e}s(this.map,0);return e.map(function(e){var t={};for(var r=0;r<n.length;r++){var i=n[r],s=e[r];t[i.name]=i.value?i.value.call(null,s):s}return t})};pv.vector=function(e,t){return new pv.Vector(e,t)};pv.Vector=function(e,t){this.x=e;this.y=t};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)};pv.Vector.prototype.norm=function(){var e=this.length();return this.times(e?1/e:1)};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};pv.Vector.prototype.times=function(e){return new pv.Vector(this.x*e,this.y*e)};pv.Vector.prototype.plus=function(e,t){return arguments.length==1?new pv.Vector(this.x+e.x,this.y+e.y):new pv.Vector(this.x+e,this.y+t)};pv.Vector.prototype.minus=function(e,t){return arguments.length==1?new pv.Vector(this.x-e.x,this.y-e.y):new pv.Vector(this.x-e,this.y-t)};pv.Vector.prototype.dot=function(e,t){return arguments.length==1?this.x*e.x+this.y*e.y:this.x*e+this.y*t};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(e,t){var n=new pv.Transform;n.k=this.k;n.x=this.k*e+this.x;n.y=this.k*t+this.y;return n};pv.Transform.prototype.scale=function(e){var t=new pv.Transform;t.k=this.k*e;t.x=this.x;t.y=this.y;return t};pv.Transform.prototype.invert=function(){var e=new pv.Transform,t=1/this.k;e.k=t;e.x=-this.x*t;e.y=-this.y*t;return e};pv.Transform.prototype.times=function(e){var t=new pv.Transform;t.k=this.k*e.k;t.x=this.k*e.x+this.x;t.y=this.k*e.y+this.y;return t};pv.Scale=function(){};pv.Scale.interpolator=function(e,t){if(typeof e=="number"){return function(n){return n*(t-e)+e}}e=pv.color(e).rgb();t=pv.color(t).rgb();return function(n){var r=e.a*(1-n)+t.a*n;if(r<1e-5)r=0;return e.a==0?pv.rgb(t.r,t.g,t.b,r):t.a==0?pv.rgb(e.r,e.g,e.b,r):pv.rgb(Math.round(e.r*(1-n)+t.r*n),Math.round(e.g*(1-n)+t.g*n),Math.round(e.b*(1-n)+t.b*n),r)}};pv.Scale.quantitative=function(){function f(e){return new Date(e)}function l(n){var i=pv.search(e,n);if(i<0)i=-i-2;i=Math.max(0,Math.min(r.length-1,i));return r[i]((o(n)-t[i])/(t[i+1]-t[i]))}var e=[0,1],t=[0,1],n=[0,1],r=[pv.identity],i=Number,s=false,o=pv.identity,u=pv.identity,a=String;l.transform=function(n,r){o=function(e){return s?-n(-e):n(e)};u=function(e){return s?-r(-e):r(e)};t=e.map(o);return this};l.domain=function(n,r,u){if(arguments.length){var a;if(n instanceof Array){if(arguments.length<2)r=pv.identity;if(arguments.length<3)u=r;a=n.length&&r(n[0]);e=n.length?[pv.min(n,r),pv.max(n,u)]:[]}else{a=n;e=Array.prototype.slice.call(arguments).map(Number)}if(!e.length)e=[-Infinity,Infinity];else if(e.length==1)e=[e[0],e[0]];s=(e[0]||e[e.length-1])<0;t=e.map(o);i=a instanceof Date?f:Number;return this}return e.map(i)};l.range=function(){if(arguments.length){n=Array.prototype.slice.call(arguments);if(!n.length)n=[-Infinity,Infinity];else if(n.length==1)n=[n[0],n[0]];r=[];for(var e=0;e<n.length-1;e++){r.push(pv.Scale.interpolator(n[e],n[e+1]))}return this}return n};l.invert=function(e){var s=pv.search(n,e);if(s<0)s=-s-2;s=Math.max(0,Math.min(r.length-1,s));return i(u(t[s]+(e-n[s])/(n[s+1]-n[s])*(t[s+1]-t[s])))};l.ticks=function(t){var n=e[0],r=e[e.length-1],s=r<n,o=s?r:n,u=s?n:r,l=u-o;if(!l||!isFinite(l)){if(i==f)a=pv.Format.date("%x");return[i(o)]}if(i==f){function c(e,t){switch(t){case 31536e6:e.setMonth(0);case 2592e6:e.setDate(1);case 6048e5:if(t==6048e5)e.setDate(e.getDate()-e.getDay());case 864e5:e.setHours(0);case 36e5:e.setMinutes(0);case 6e4:e.setSeconds(0);case 1e3:e.setMilliseconds(0)}}var h,p,v,m=1;if(l>=3*31536e6){h=31536e6;p="%Y";v=function(e){e.setFullYear(e.getFullYear()+m)}}else if(l>=3*2592e6){h=2592e6;p="%m/%Y";v=function(e){e.setMonth(e.getMonth()+m)}}else if(l>=3*6048e5){h=6048e5;p="%m/%d";v=function(e){e.setDate(e.getDate()+7*m)}}else if(l>=3*864e5){h=864e5;p="%m/%d";v=function(e){e.setDate(e.getDate()+m)}}else if(l>=3*36e5){h=36e5;p="%I:%M %p";v=function(e){e.setHours(e.getHours()+m)}}else if(l>=3*6e4){h=6e4;p="%I:%M %p";v=function(e){e.setMinutes(e.getMinutes()+m)}}else if(l>=3*1e3){h=1e3;p="%I:%M:%S";v=function(e){e.setSeconds(e.getSeconds()+m)}}else{h=1;p="%S.%Qs";v=function(e){e.setTime(e.getTime()+m)}}a=pv.Format.date(p);var g=new Date(o),y=[];c(g,h);var b=l/h;if(b>10){switch(h){case 36e5:{m=b>20?6:3;g.setHours(Math.floor(g.getHours()/m)*m);break};case 2592e6:{m=3;g.setMonth(Math.floor(g.getMonth()/m)*m);break};case 6e4:{m=b>30?15:b>15?10:5;g.setMinutes(Math.floor(g.getMinutes()/m)*m);break};case 1e3:{m=b>90?15:b>60?10:5;g.setSeconds(Math.floor(g.getSeconds()/m)*m);break};case 1:{m=b>1e3?250:b>200?100:b>100?50:b>50?25:5;g.setMilliseconds(Math.floor(g.getMilliseconds()/m)*m);break};default:{m=pv.logCeil(b/15,10);if(b/m<2)m/=5;else if(b/m<5)m/=2;g.setFullYear(Math.floor(g.getFullYear()/m)*m);break}}}while(true){v(g);if(g>u)break;y.push(new Date(g))}return s?y.reverse():y}if(!arguments.length)t=10;var m=pv.logFloor(l/t,10),w=t/(l/m);if(w<=.15)m*=10;else if(w<=.35)m*=5;else if(w<=.75)m*=2;var n=Math.ceil(o/m)*m,r=Math.floor(u/m)*m;a=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(m,10)+.01)));var E=pv.range(n,r+m,m);return s?E.reverse():E};l.tickFormat=function(e){return a(e)};l.nice=function(){if(e.length!=2)return this;var n=e[0],r=e[e.length-1],i=r<n,s=i?r:n,u=i?n:r,a=u-s;if(!a||!isFinite(a))return this;var f=Math.pow(10,Math.round(Math.log(a)/Math.log(10))-1);e=[Math.floor(s/f)*f,Math.ceil(u/f)*f];if(i)e.reverse();t=e.map(o);return this};l.by=function(e){function t(){return l(e.apply(this,arguments))}for(var n in l)t[n]=l[n];return t};l.domain.apply(l,arguments);return l};pv.Scale.linear=function(){var e=pv.Scale.quantitative();e.domain.apply(e,arguments);return e};pv.Scale.log=function(){var e=pv.Scale.quantitative(1,10),t,n,r=function(e){return Math.log(e)/n},i=function(e){return Math.pow(t,e)};e.ticks=function(){var n=e.domain(),s=n[0]<0,o=Math.floor(s?-r(-n[0]):r(n[0])),u=Math.ceil(s?-r(-n[1]):r(n[1])),a=[];if(s){a.push(-i(-o));for(;o++<u;)for(var f=t-1;f>0;f--)a.push(-i(-o)*f)}else{for(;o<u;o++)for(var f=1;f<t;f++)a.push(i(o)*f);a.push(i(o))}for(o=0;a[o]<n[0];o++);for(u=a.length;a[u-1]>n[1];u--);return a.slice(o,u)};e.tickFormat=function(e){return e.toPrecision(1)};e.nice=function(){var n=e.domain();return e.domain(pv.logFloor(n[0],t),pv.logCeil(n[1],t))};e.base=function(s){if(arguments.length){t=Number(s);n=Math.log(t);e.transform(r,i);return this}return t};e.domain.apply(e,arguments);return e.base(10)};pv.Scale.root=function(){var e=pv.Scale.quantitative();e.power=function(t){if(arguments.length){var n=Number(t),r=1/n;e.transform(function(e){return Math.pow(e,r)},function(e){return Math.pow(e,n)});return this}return n};e.domain.apply(e,arguments);return e.power(2)};pv.Scale.ordinal=function(){function i(r){if(!(r in t))t[r]=e.push(r)-1;return n[t[r]%n.length]}var e=[],t={},n=[],r=0;i.domain=function(n,r){if(arguments.length){n=n instanceof Array?arguments.length>1?pv.map(n,r):n:Array.prototype.slice.call(arguments);e=[];var i={};for(var s=0;s<n.length;s++){var o=n[s];if(!(o in i)){i[o]=true;e.push(o)}}t=pv.numerate(e);return this}return e};i.range=function(e,t){if(arguments.length){n=e instanceof Array?arguments.length>1?pv.map(e,t):e:Array.prototype.slice.call(arguments);if(typeof n[0]=="string")n=n.map(pv.color);return this}return n};i.split=function(e,t){var r=(t-e)/this.domain().length;n=pv.range(e+r/2,t,r);return this};i.splitFlush=function(e,t){var r=this.domain().length,i=(t-e)/(r-1);n=r==1?[(e+t)/2]:pv.range(e,t+i/2,i);return this};i.splitBanded=function(e,t,r){if(arguments.length<3)r=1;if(r<0){var i=this.domain().length,s=-r*i,o=t-e-s,u=o/(i+1);n=pv.range(e+u,t,u-r);n.band=-r}else{var a=(t-e)/(this.domain().length+(1-r));n=pv.range(e+a*(1-r),t,a);n.band=a*r}return this};i.by=function(e){function t(){return i(e.apply(this,arguments))}for(var n in i)t[n]=i[n];return t};i.domain.apply(i,arguments);return i};pv.Scale.quantile=function(){function s(e){return i(Math.max(0,Math.min(t,pv.search.index(n,e)-1))/t)}var e=-1,t=-1,n=[],r=[],i=pv.Scale.linear();s.quantiles=function(i){if(arguments.length){e=Number(i);if(e<0){n=[r[0]].concat(r);t=r.length-1}else{n=[];n[0]=r[0];for(var s=1;s<=e;s++){n[s]=r[~~(s*(r.length-1)/e)]}t=e-1}return this}return n};s.domain=function(t,n){if(arguments.length){r=t instanceof Array?pv.map(t,n):Array.prototype.slice.call(arguments);r.sort(pv.naturalOrder);s.quantiles(e);return this}return r};s.range=function(){if(arguments.length){i.range.apply(i,arguments);return this}return i.range()};s.by=function(e){function t(){return s(e.apply(this,arguments))}for(var n in s)t[n]=s[n];return t};s.domain.apply(s,arguments);return s};pv.histogram=function(e,t){var n=true;return{bins:function(r){var i=pv.map(e,t),s=[];if(!arguments.length)r=pv.Scale.linear(i).ticks();for(var o=0;o<r.length-1;o++){var u=s[o]=[];u.x=r[o];u.dx=r[o+1]-r[o];u.y=0}for(var o=0;o<i.length;o++){var a=pv.search.index(r,i[o])-1,u=s[Math.max(0,Math.min(s.length-1,a))];u.y++;u.push(e[o])}if(!n)for(var o=0;o<s.length;o++){s[o].y/=i.length}return s},frequency:function(e){if(arguments.length){n=Boolean(e);return this}return n}}};pv.color=function(e){if(e.rgb)return e.rgb();var t=/([a-z]+)\((.*)\)/i.exec(e);if(t){var n=t[2].split(","),r=1;switch(t[1]){case"hsla":case"rgba":{r=parseFloat(n[3]);if(!r)return pv.Color.transparent;break}}switch(t[1]){case"hsla":case"hsl":{var i=parseFloat(n[0]),s=parseFloat(n[1])/100,o=parseFloat(n[2])/100;return(new pv.Color.Hsl(i,s,o,r)).rgb()};case"rgba":case"rgb":{function u(e){var t=parseFloat(e);return e[e.length-1]=="%"?Math.round(t*2.55):t}var a=u(n[0]),f=u(n[1]),l=u(n[2]);return pv.rgb(a,f,l,r)}}}var c=pv.Color.names[e];if(c)return c;if(e.charAt(0)=="#"){var a,f,l;if(e.length==4){a=e.charAt(1);a+=a;f=e.charAt(2);f+=f;l=e.charAt(3);l+=l}else if(e.length==7){a=e.substring(1,3);f=e.substring(3,5);l=e.substring(5,7)}return pv.rgb(parseInt(a,16),parseInt(f,16),parseInt(l,16),1)}return new pv.Color(e,1)};pv.Color=function(e,t){this.color=e;this.opacity=t};pv.Color.prototype.brighter=function(e){return this.rgb().brighter(e)};pv.Color.prototype.darker=function(e){return this.rgb().darker(e)};pv.rgb=function(e,t,n,r){return new pv.Color.Rgb(e,t,n,arguments.length==4?r:1)};pv.Color.Rgb=function(e,t,n,r){pv.Color.call(this,r?"rgb("+e+","+t+","+n+")":"none",r);this.r=e;this.g=t;this.b=n;this.a=r};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(e){return pv.rgb(e,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(e){return pv.rgb(this.r,e,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(e){return pv.rgb(this.r,this.g,e,this.a)};pv.Color.Rgb.prototype.alpha=function(e){return pv.rgb(this.r,this.g,this.b,e)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;if(!t&&!n&&!r)return pv.rgb(i,i,i,this.a);if(t&&t<i)t=i;if(n&&n<i)n=i;if(r&&r<i)r=i;return pv.rgb(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e)),this.a)};pv.Color.Rgb.prototype.darker=function(e){e=Math.pow(.7,arguments.length?e:1);return pv.rgb(Math.max(0,Math.floor(e*this.r)),Math.max(0,Math.floor(e*this.g)),Math.max(0,Math.floor(e*this.b)),this.a)};pv.hsl=function(e,t,n,r){return new pv.Color.Hsl(e,t,n,arguments.length==4?r:1)};pv.Color.Hsl=function(e,t,n,r){pv.Color.call(this,"hsl("+e+","+t*100+"%,"+n*100+"%)",r);this.h=e;this.s=t;this.l=n;this.a=r};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hue=function(e){return pv.hsl(e,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(e){return pv.hsl(this.h,e,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(e){return pv.hsl(this.h,this.s,e,this.a)};pv.Color.Hsl.prototype.alpha=function(e){return pv.hsl(this.h,this.s,this.l,e)};pv.Color.Hsl.prototype.rgb=function(){function s(e){if(e>360)e-=360;else if(e<0)e+=360;if(e<60)return i+(r-i)*e/60;if(e<180)return r;if(e<240)return i+(r-i)*(240-e)/60;return i}function o(e){return Math.round(s(e)*255)}var e=this.h,t=this.s,n=this.l;e=e%360;if(e<0)e+=360;t=Math.max(0,Math.min(t,1));n=Math.max(0,Math.min(n,1));var r=n<=.5?n*(1+t):n+t-n*t;var i=2*n-r;return pv.rgb(o(e+120),o(e),o(e-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var e=pv.Color.names;for(var t in e)e[t]=pv.color(e[t])})();pv.colors=function(){var e=pv.Scale.ordinal();e.range.apply(e,arguments);return e};pv.Colors={};pv.Colors.category10=function(){var e=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");e.domain.apply(e,arguments);return e};pv.Colors.category20=function(){var e=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");e.domain.apply(e,arguments);return e};pv.Colors.category19=function(){var e=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");e.domain.apply(e,arguments);return e};pv.ramp=function(e,t){var n=pv.Scale.linear();n.range.apply(n,arguments);return n};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-dasharray":"none","stroke-linejoin":"miter"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(e){if(e.length&&e[0].reverse&&e.type!="line"&&e.type!="area"){var t=pv.extend(e);for(var n=0,r=e.length-1;r>=0;n++,r--){t[n]=e[r]}e=t}this.removeSiblings(this[e.type](e))};pv.SvgScene.create=function(e){return document.createElementNS(this.svg,e)};pv.SvgScene.expect=function(e,t,n,r){if(e){if(e.tagName=="a")e=e.firstChild;if(e.tagName!=t){var i=this.create(t);e.parentNode.replaceChild(i,e);e=i}}else{e=this.create(t)}for(var s in n){var o=n[s];if(o==this.implicit.svg[s])o=null;if(o==null)e.removeAttribute(s);else e.setAttribute(s,o)}for(var s in r){var o=r[s];if(o==this.implicit.css[s])o=null;if(o==null)e.style.removeProperty(s);else e.style[s]=o}return e};pv.SvgScene.append=function(e,t,n){e.$scene={scenes:t,index:n};e=this.title(e,t[n]);if(!e.parentNode)t.$g.appendChild(e);return e.nextSibling};pv.SvgScene.title=function(e,t){var n=e.parentNode;if(n&&n.tagName!="a")n=null;if(t.title){if(!n){n=this.create("a");if(e.parentNode)e.parentNode.replaceChild(n,e);n.appendChild(e)}n.setAttributeNS(this.xlink,"title",t.title);return n}if(n)n.parentNode.replaceChild(e,n);return e};pv.SvgScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var n=e.type;switch(n){case"DOMMouseScroll":{n="mousewheel";e.wheel=-480*e.detail;break};case"mousewheel":{e.wheel=(window.opera?12:1)*e.wheelDelta;break}}if(pv.Mark.dispatch(n,t.scenes,t.index))e.preventDefault()}});pv.SvgScene.removeSiblings=function(e){while(e){var t=e.nextSibling;e.parentNode.removeChild(e);e=t}};pv.SvgScene.undefined=function(){};pv.SvgScene.pathBasis=function(){function t(e,t,n,r,i){return{x:e[0]*t.left+e[1]*n.left+e[2]*r.left+e[3]*i.left,y:e[0]*t.top+e[1]*n.top+e[2]*r.top+e[3]*i.top}}var e=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];var n=function(n,r,i,s){var o=t(e[1],n,r,i,s),u=t(e[2],n,r,i,s),a=t(e[3],n,r,i,s);return"C"+o.x+","+o.y+","+u.x+","+u.y+","+a.x+","+a.y};n.segment=function(n,r,i,s){var o=t(e[0],n,r,i,s),u=t(e[1],n,r,i,s),a=t(e[2],n,r,i,s),f=t(e[3],n,r,i,s);return"M"+o.x+","+o.y+"C"+u.x+","+u.y+","+a.x+","+a.y+","+f.x+","+f.y};return n}();pv.SvgScene.curveBasis=function(e){if(e.length<=2)return"";var t="",n=e[0],r=n,i=n,s=e[1];t+=this.pathBasis(n,r,i,s);for(var o=2;o<e.length;o++){n=r;r=i;i=s;s=e[o];t+=this.pathBasis(n,r,i,s)}t+=this.pathBasis(r,i,s,s);t+=this.pathBasis(i,s,s,s);return t};pv.SvgScene.curveBasisSegments=function(e){if(e.length<=2)return"";var t=[],n=e[0],r=n,i=n,s=e[1],o=this.pathBasis.segment(n,r,i,s);n=r;r=i;i=s;s=e[2];t.push(o+this.pathBasis(n,r,i,s));for(var u=3;u<e.length;u++){n=r;r=i;i=s;s=e[u];t.push(this.pathBasis.segment(n,r,i,s))}t.push(this.pathBasis.segment(r,i,s,s)+this.pathBasis(i,s,s,s));return t};pv.SvgScene.curveHermite=function(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return"";var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n){r+="Q"+(s.left-o.x*2/3)+","+(s.top-o.y*2/3)+","+s.left+","+s.top;i=e[1];a=2}if(t.length>1){u=t[1];s=e[a];a++;r+="C"+(i.left+o.x)+","+(i.top+o.y)+","+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top;for(var f=2;f<t.length;f++,a++){s=e[a];u=t[f];r+="S"+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top}}if(n){var l=e[a];r+="Q"+(s.left+u.x*2/3)+","+(s.top+u.y*2/3)+","+l.left+","+l.top}return r};pv.SvgScene.curveHermiteSegments=function(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return[];var n=e.length!=t.length,r=[],i=e[0],s=i,o=t[0],u=o,a=1;if(n){s=e[1];r.push("M"+i.left+","+i.top+"Q"+(s.left-u.x*2/3)+","+(s.top-u.y*2/3)+","+s.left+","+s.top);a=2}for(var f=1;f<t.length;f++,a++){i=s;o=u;s=e[a];u=t[f];r.push("M"+i.left+","+i.top+"C"+(i.left+o.x)+","+(i.top+o.y)+","+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top)}if(n){var l=e[a];r.push("M"+s.left+","+s.top+"Q"+(s.left+u.x*2/3)+","+(s.top+u.y*2/3)+","+l.left+","+l.top)}return r};pv.SvgScene.cardinalTangents=function(e,t){var n=[],r=(1-t)/2,i=e[0],s=e[1],o=e[2];for(var u=3;u<e.length;u++){n.push({x:r*(o.left-i.left),y:r*(o.top-i.top)});i=s;s=o;o=e[u]}n.push({x:r*(o.left-i.left),y:r*(o.top-i.top)});return n};pv.SvgScene.curveCardinal=function(e,t){if(e.length<=2)return"";return this.curveHermite(e,this.cardinalTangents(e,t))};pv.SvgScene.curveCardinalSegments=function(e,t){if(e.length<=2)return"";return this.curveHermiteSegments(e,this.cardinalTangents(e,t))};pv.SvgScene.monotoneTangents=function(e){var t=[],n=[],r=[],i=[],s=0;for(s=0;s<e.length-1;s++){n[s]=(e[s+1].top-e[s].top)/(e[s+1].left-e[s].left)}r[0]=n[0];i[0]=e[1].left-e[0].left;for(s=1;s<e.length-1;s++){r[s]=(n[s-1]+n[s])/2;i[s]=(e[s+1].left-e[s-1].left)/2}r[s]=n[s-1];i[s]=e[s].left-e[s-1].left;for(s=0;s<e.length-1;s++){if(n[s]==0){r[s]=0;r[s+1]=0}}for(s=0;s<e.length-1;s++){if(Math.abs(r[s])<1e-5||Math.abs(r[s+1])<1e-5)continue;var o=r[s]/n[s],u=r[s+1]/n[s],a=o*o+u*u;if(a>9){var f=3/Math.sqrt(a);r[s]=f*o*n[s];r[s+1]=f*u*n[s]}}var l;for(var c=0;c<e.length;c++){l=1+r[c]*r[c];t.push({x:i[c]/3/l,y:r[c]*i[c]/3/l})}return t};pv.SvgScene.curveMonotone=function(e){if(e.length<=2)return"";return this.curveHermite(e,this.monotoneTangents(e))};pv.SvgScene.curveMonotoneSegments=function(e){if(e.length<=2)return"";return this.curveHermiteSegments(e,this.monotoneTangents(e))};pv.SvgScene.area=function(e){function s(t,r){var i=[],s=[];for(var o=r;t<=o;t++,r--){var u=e[t],a=e[r],f=u.left+","+u.top,l=a.left+a.width+","+(a.top+a.height);if(t<o){var c=e[t+1],h=e[r-1];switch(n.interpolate){case"step-before":{f+="V"+c.top;l+="H"+(h.left+h.width);break};case"step-after":{f+="H"+c.left;l+="V"+(h.top+h.height);break}}}i.push(f);s.push(l)}return i.concat(s).join("L")}function o(t,r){var i=[],s=[],o,u;for(var a=r;t<=a;t++,r--){var f=e[r];i.push(e[t]);s.push({left:f.left+f.width,top:f.top+f.height})}if(n.interpolate=="basis"){o=pv.SvgScene.curveBasis(i);u=pv.SvgScene.curveBasis(s)}else if(n.interpolate=="cardinal"){o=pv.SvgScene.curveCardinal(i,n.tension);u=pv.SvgScene.curveCardinal(s,n.tension)}else{o=pv.SvgScene.curveMonotone(i);u=pv.SvgScene.curveMonotone(s)}return i[0].left+","+i[0].top+o+"L"+s[0].left+","+s[0].top+u}var t=e.$g.firstChild;if(!e.length)return t;var n=e[0];if(n.segmented)return this.areaSegment(e);if(!n.visible)return t;var r=n.fillStyle,i=n.strokeStyle;if(!r.opacity&&!i.opacity)return t;var u=[],a,f;for(var l=0;l<e.length;l++){a=e[l];if(!a.width&&!a.height)continue;for(var c=l+1;c<e.length;c++){f=e[c];if(!f.width&&!f.height)break}if(l&&n.interpolate!="step-after")l--;if(c<e.length&&n.interpolate!="step-before")c++;u.push((c-l>2&&(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone")?o:s)(l,c-1));l=c-1}if(!u.length)return t;t=this.expect(t,"path",{"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,d:"M"+u.join("ZM")+"Z",fill:r.color,"fill-opacity":r.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?n.lineWidth/this.scale:null,"stroke-dasharray":n.strokeDasharray});return this.append(t,e,0)};pv.SvgScene.areaSegment=function(e){var t=e.$g.firstChild,n=e[0],r,i;if(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone"){var s=[],o=[];for(var u=0,a=e.length;u<a;u++){var f=e[a-u-1];s.push(e[u]);o.push({left:f.left+f.width,top:f.top+f.height})}if(n.interpolate=="basis"){r=this.curveBasisSegments(s);i=this.curveBasisSegments(o)}else if(n.interpolate=="cardinal"){r=this.curveCardinalSegments(s,n.tension);i=this.curveCardinalSegments(o,n.tension)}else{r=this.curveMonotoneSegments(s);i=this.curveMonotoneSegments(o)}}for(var u=0,a=e.length-1;u<a;u++){var l=e[u],c=e[u+1];if(!l.visible||!c.visible)continue;var h=l.fillStyle,p=l.strokeStyle;if(!h.opacity&&!p.opacity)continue;var d;if(r){var v=r[u],m="L"+i[a-u-1].substr(1);d=v+m+"Z"}else{var g=l,f=c;switch(l.interpolate){case"step-before":g=c;break;case"step-after":f=l;break}d="M"+l.left+","+g.top+"L"+c.left+","+f.top+"L"+(c.left+c.width)+","+(f.top+f.height)+"L"+(l.left+l.width)+","+(g.top+g.height)+"Z"}t=this.expect(t,"path",{"shape-rendering":l.antialias?null:"crispEdges","pointer-events":l.events,cursor:l.cursor,d:d,fill:h.color,"fill-opacity":h.opacity||null,stroke:p.color,"stroke-opacity":p.opacity||null,"stroke-width":p.opacity?l.lineWidth/this.scale:null,"stroke-dasharray":l.strokeDasharray});t=this.append(t,e,u)}return t};pv.SvgScene.bar=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;t=this.expect(t,"rect",{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x:r.left,y:r.top,width:Math.max(1e-10,r.width),height:Math.max(1e-10,r.height),fill:i.color,"fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":s.opacity?r.lineWidth/this.scale:null});t=this.append(t,e,n)}return t};pv.SvgScene.dot=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;var o=r.radius,u=null;switch(r.shape){case"cross":{u="M"+ -o+","+ -o+"L"+o+","+o+"M"+o+","+ -o+"L"+ -o+","+o;break};case"triangle":{var a=o,f=o*1.1547;u="M0,"+a+"L"+f+","+ -a+" "+ -f+","+ -a+"Z";break};case"diamond":{o*=Math.SQRT2;u="M0,"+ -o+"L"+o+",0"+" 0,"+o+" "+ -o+",0"+"Z";break};case"square":{u="M"+ -o+","+ -o+"L"+o+","+ -o+" "+o+","+o+" "+ -o+","+o+"Z";break};case"tick":{u="M0,0L0,"+ -r.size;break};case"bar":{u="M0,"+r.size/2+"L0,"+ -(r.size/2);break}}var l={"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,fill:i.color,"fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":s.opacity?r.lineWidth/this.scale:null};if(u){l.transform="translate("+r.left+","+r.top+")";if(r.angle)l.transform+=" rotate("+180*r.angle/Math.PI+")";l.d=u;t=this.expect(t,"path",l)}else{l.cx=r.left;l.cy=r.top;l.r=o;t=this.expect(t,"circle",l)}t=this.append(t,e,n)}return t};pv.SvgScene.image=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;t=this.fill(t,e,n);if(r.image){t=this.expect(t,"foreignObject",{cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height});var i=t.firstChild||t.appendChild(document.createElementNS(this.xhtml,"canvas"));i.$scene={scenes:e,index:n};i.style.width=r.width;i.style.height=r.height;i.width=r.imageWidth;i.height=r.imageHeight;i.getContext("2d").putImageData(r.image,0,0)}else{t=this.expect(t,"image",{preserveAspectRatio:"none",cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height});t.setAttributeNS(this.xlink,"href",r.url)}t=this.append(t,e,n);t=this.stroke(t,e,n)}return t};pv.SvgScene.label=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.textStyle;if(!i.opacity||!r.text)continue;var s=0,o=0,u=0,a="start";switch(r.textBaseline){case"middle":u=".35em";break;case"top":u=".71em";o=r.textMargin;break;case"bottom":o="-"+r.textMargin;break}switch(r.textAlign){case"right":a="end";s="-"+r.textMargin;break;case"center":a="middle";break;case"left":s=r.textMargin;break}t=this.expect(t,"text",{"pointer-events":r.events,cursor:r.cursor,x:s,y:o,dy:u,transform:"translate("+r.left+","+r.top+")"+(r.textAngle?" rotate("+180*r.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:i.color,"fill-opacity":i.opacity||null,"text-anchor":a},{font:r.font,"text-shadow":r.textShadow,"text-decoration":r.textDecoration});if(t.firstChild)t.firstChild.nodeValue=r.text;else t.appendChild(document.createTextNode(r.text));t=this.append(t,e,n)}return t};pv.SvgScene.line=function(e){var t=e.$g.firstChild;if(e.length<2)return t;var n=e[0];if(n.segmented)return this.lineSegment(e);if(!n.visible)return t;var r=n.fillStyle,i=n.strokeStyle;if(!r.opacity&&!i.opacity)return t;var s="M"+n.left+","+n.top;if(e.length>2&&(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone")){switch(n.interpolate){case"basis":s+=this.curveBasis(e);break;case"cardinal":s+=this.curveCardinal(e,n.tension);break;case"monotone":s+=this.curveMonotone(e);break}}else{for(var o=1;o<e.length;o++){s+=this.pathSegment(e[o-1],e[o])}}t=this.expect(t,"path",{"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,d:s,fill:r.color,"fill-opacity":r.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?n.lineWidth/this.scale:null,"stroke-dasharray":n.strokeDasharray,"stroke-linejoin":n.lineJoin});return this.append(t,e,0)};pv.SvgScene.lineSegment=function(e){var t=e.$g.firstChild;var n=e[0];var r;switch(n.interpolate){case"basis":r=this.curveBasisSegments(e);break;case"cardinal":r=this.curveCardinalSegments(e,n.tension);break;case"monotone":r=this.curveMonotoneSegments(e);break}for(var i=0,s=e.length-1;i<s;i++){var o=e[i],u=e[i+1];if(!o.visible||!u.visible)continue;var a=o.strokeStyle,f=pv.Color.transparent;if(!a.opacity)continue;var l;if(o.interpolate=="linear"&&o.lineJoin=="miter"){f=a;a=pv.Color.transparent;l=this.pathJoin(e[i-1],o,u,e[i+2])}else if(r){l=r[i]}else{l="M"+o.left+","+o.top+this.pathSegment(o,u)}t=this.expect(t,"path",{"shape-rendering":o.antialias?null:"crispEdges","pointer-events":o.events,cursor:o.cursor,d:l,fill:f.color,"fill-opacity":f.opacity||null,stroke:a.color,"stroke-opacity":a.opacity||null,"stroke-width":a.opacity?o.lineWidth/this.scale:null,"stroke-dasharray":o.strokeDasharray,"stroke-linejoin":o.lineJoin});t=this.append(t,e,i)}return t};pv.SvgScene.pathSegment=function(e,t){var n=1;switch(e.interpolate){case"polar-reverse":n=0;case"polar":{var r=t.left-e.left,i=t.top-e.top,s=1-e.eccentricity,o=Math.sqrt(r*r+i*i)/(2*s);if(s<=0||s>1)break;return"A"+o+","+o+" 0 0,"+n+" "+t.left+","+t.top};case"step-before":return"V"+t.top+"H"+t.left;case"step-after":return"H"+t.left+"V"+t.top}return"L"+t.left+","+t.top};pv.SvgScene.lineIntersect=function(e,t,n,r){return e.plus(t.times(n.minus(e).dot(r.perp())/t.dot(r.perp())))};pv.SvgScene.pathJoin=function(e,t,n,r){var i=pv.vector(t.left,t.top),s=pv.vector(n.left,n.top),o=s.minus(i),u=o.perp().norm(),a=u.times(t.lineWidth/(2*this.scale)),f=i.plus(a),l=s.plus(a),c=s.minus(a),h=i.minus(a);if(e&&e.visible){var p=i.minus(e.left,e.top).perp().norm().plus(u);h=this.lineIntersect(i,p,h,o);f=this.lineIntersect(i,p,f,o)}if(r&&r.visible){var d=pv.vector(r.left,r.top).minus(s).perp().norm().plus(u);c=this.lineIntersect(s,d,c,o);l=this.lineIntersect(s,d,l,o)}return"M"+f.x+","+f.y+"L"+l.x+","+l.y+" "+c.x+","+c.y+" "+h.x+","+h.y};pv.SvgScene.panel=function(e){var t=e.$g,n=t&&t.firstChild;for(var r=0;r<e.length;r++){var i=e[r];if(!i.visible)continue;if(!e.parent){i.canvas.style.display="inline-block";if(t&&t.parentNode!=i.canvas){t=i.canvas.firstChild;n=t&&t.firstChild}if(!t){t=i.canvas.appendChild(this.create("svg"));t.setAttribute("font-size","10px");t.setAttribute("font-family","sans-serif");t.setAttribute("fill","none");t.setAttribute("stroke","none");t.setAttribute("stroke-width",1.5);for(var s=0;s<this.events.length;s++){t.addEventListener(this.events[s],this.dispatch,false)}n=t.firstChild}e.$g=t;t.setAttribute("width",i.width+i.left+i.right);t.setAttribute("height",i.height+i.top+i.bottom)}if(i.overflow=="hidden"){var o=pv.id().toString(36),u=this.expect(n,"g",{"clip-path":"url(#"+o+")"});if(!u.parentNode)t.appendChild(u);e.$g=t=u;n=u.firstChild;n=this.expect(n,"clipPath",{id:o});var a=n.firstChild||n.appendChild(this.create("rect"));a.setAttribute("x",i.left);a.setAttribute("y",i.top);a.setAttribute("width",i.width);a.setAttribute("height",i.height);if(!n.parentNode)t.appendChild(n);n=n.nextSibling}n=this.fill(n,e,r);var f=this.scale,l=i.transform,c=i.left+l.x,h=i.top+l.y;this.scale*=l.k;for(var s=0;s<i.children.length;s++){i.children[s].$g=n=this.expect(n,"g",{transform:"translate("+c+","+h+")"+(l.k!=1?" scale("+l.k+")":"")});this.updateAll(i.children[s]);if(!n.parentNode)t.appendChild(n);n=n.nextSibling}this.scale=f;n=this.stroke(n,e,r);if(i.overflow=="hidden"){e.$g=t=u.parentNode;n=u.nextSibling}}return n};pv.SvgScene.fill=function(e,t,n){var r=t[n],i=r.fillStyle;if(i.opacity||r.events=="all"){e=this.expect(e,"rect",{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height,fill:i.color,"fill-opacity":i.opacity,stroke:null});e=this.append(e,t,n)}return e};pv.SvgScene.stroke=function(e,t,n){var r=t[n],i=r.strokeStyle;if(i.opacity||r.events=="all"){e=this.expect(e,"rect",{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events=="all"?"stroke":r.events,cursor:r.cursor,x:r.left,y:r.top,width:Math.max(1e-10,r.width),height:Math.max(1e-10,r.height),fill:null,stroke:i.color,"stroke-opacity":i.opacity,"stroke-width":r.lineWidth/this.scale,"stroke-dasharray":r.strokeDasharray});e=this.append(e,t,n)}return e};pv.SvgScene.rule=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.strokeStyle;if(!i.opacity)continue;t=this.expect(t,"line",{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x1:r.left,y1:r.top,x2:r.left+r.width,y2:r.top+r.height,stroke:i.color,"stroke-opacity":i.opacity,"stroke-dasharray":r.strokeDasharray,"stroke-width":r.lineWidth/this.scale});t=this.append(t,e,n)}return t};pv.SvgScene.wedge=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;var o=r.innerRadius,u=r.outerRadius,a=Math.abs(r.angle),f;if(a>=2*Math.PI){if(o){f="M0,"+u+"A"+u+","+u+" 0 1,1 0,"+ -u+"A"+u+","+u+" 0 1,1 0,"+u+"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+ -o+"A"+o+","+o+" 0 1,1 0,"+o+"Z"}else{f="M0,"+u+"A"+u+","+u+" 0 1,1 0,"+ -u+"A"+u+","+u+" 0 1,1 0,"+u+"Z"}}else{var l=Math.min(r.startAngle,r.endAngle),c=Math.max(r.startAngle,r.endAngle),h=Math.cos(l),p=Math.cos(c),d=Math.sin(l),v=Math.sin(c);if(o){f="M"+u*h+","+u*d+"A"+u+","+u+" 0 "+(a<Math.PI?"0":"1")+",1 "+u*p+","+u*v+"L"+o*p+","+o*v+"A"+o+","+o+" 0 "+(a<Math.PI?"0":"1")+",0 "+o*h+","+o*d+"Z"}else{f="M"+u*h+","+u*d+"A"+u+","+u+" 0 "+(a<Math.PI?"0":"1")+",1 "+u*p+","+u*v+"L0,0Z"}}t=this.expect(t,"path",{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,transform:"translate("+r.left+","+r.top+")",d:f,fill:i.color,"fill-rule":"evenodd","fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":s.opacity?r.lineWidth/this.scale:null});t=this.append(t,e,n)}return t};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(e,t){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[e]=true;pv.Mark.prototype.propertyMethod(e,false,pv.Mark.cast[e]=t);return this};pv.Mark.prototype.propertyMethod=function(e,t,n){if(!n)n=pv.Mark.cast[e];this[e]=function(r){if(t&&this.scene){var i=this.scene.defs;if(arguments.length){i[e]={id:r==null?0:pv.id(),value:r!=null&&n?n(r):r};return this}return i[e]?i[e].value:null}if(arguments.length){var s=!t<<1|typeof r=="function";this.propertyValue(e,s&1&&n?function(){var e=r.apply(this,arguments);return e!=null?n(e):null}:r!=null&&n?n(r):r).type=s;return this}return this.instance()[e]}};pv.Mark.prototype.propertyValue=function(e,t){var n=this.$properties,r={name:e,id:pv.id(),value:t};for(var i=0;i<n.length;i++){if(n[i].name==e){n.splice(i,1);break}}n.push(r);return r};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype.defaults=(new pv.Mark).data(function(e){return[e]}).visible(true).antialias(true).events("painted");pv.Mark.prototype.extend=function(e){this.proto=e;this.target=e.target;return this};pv.Mark.prototype.add=function(e){return this.parent.add(e).extend(this)};pv.Mark.prototype.def=function(e,t){this.propertyMethod(e,true);return this[e](arguments.length>1?t:null)};pv.Mark.prototype.anchor=function(e){if(!e)e="center";return(new pv.Anchor(this)).name(e).data(function(){return this.scene.target.map(function(e){return e.data})}).visible(function(){return this.scene.target[this.index].visible}).left(function(){var e=this.scene.target[this.index],t=e.width||0;switch(this.name()){case"bottom":case"top":case"center":return e.left+t/2;case"left":return null}return e.left+t}).top(function(){var e=this.scene.target[this.index],t=e.height||0;switch(this.name()){case"left":case"right":case"center":return e.top+t/2;case"top":return null}return e.top+t}).right(function(){var e=this.scene.target[this.index];return this.name()=="left"?e.right+(e.width||0):null}).bottom(function(){var e=this.scene.target[this.index];return this.name()=="top"?e.bottom+(e.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Mark.prototype.anchorTarget=function(){return this.target};pv.Mark.prototype.margin=function(e){return this.left(e).right(e).top(e).bottom(e)};pv.Mark.prototype.instance=function(e){var t=this.scene||this.parent.instance(-1).children[this.childIndex],n=!arguments.length||this.hasOwnProperty("index")?this.index:e;return t[n<0?t.length-1:n]};pv.Mark.prototype.instances=function(e){var t=this,n=[],r;while(!(r=t.scene)){e=e.parent;n.push({index:e.index,childIndex:t.childIndex});t=t.parent}while(n.length){var i=n.pop();r=r[i.index].children[i.childIndex]}if(this.hasOwnProperty("index")){var s=pv.extend(r[this.index]);s.right=s.top=s.left=s.bottom=0;return[s]}return r};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};pv.Mark.prototype.sibling=function(){return this.index==0?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var e=this.parent,t=e&&e.sibling();return t&&t.children?t.children[this.childIndex][this.index]:null};pv.Mark.prototype.render=function(){function i(e,r,i){e.scale=i;if(r<n.length){t.unshift(null);if(e.hasOwnProperty("index")){s(e,r,i)}else{for(var o=0,u=e.scene.length;o<u;o++){e.index=o;s(e,r,i)}delete e.index}t.shift()}else{e.build();pv.Scene.scale=i;pv.Scene.updateAll(e.scene)}delete e.scale}function s(e,r,s){var o=e.scene[e.index],u;if(o.visible){var a=n[r],f=e.children[a];for(u=0;u<a;u++){e.children[u].scene=o.children[u]}t[0]=o.data;if(f.scene){i(f,r+1,s*o.transform.k)}else{f.scene=o.children[a];i(f,r+1,s*o.transform.k);delete f.scene}for(u=0;u<a;u++){delete e.children[u].scene}}}var e=this.parent,t=pv.Mark.stack;if(e&&!this.root.scene){this.root.render();return}var n=[];for(var r=this;r.parent;r=r.parent){n.unshift(r.childIndex)}this.bind();while(e&&!e.hasOwnProperty("index"))e=e.parent;this.context(e?e.scene:undefined,e?e.index:-1,function(){i(this.root,0,1)})};pv.Mark.stack=[];pv.Mark.prototype.bind=function(){function i(i){do{var s=i.$properties;for(var o=s.length-1;o>=0;o--){var u=s[o];if(!(u.name in e)){e[u.name]=u;switch(u.name){case"data":n=u;break;case"visible":r=u;break;default:t[u.type].push(u);break}}}}while(i=i.proto)}var e={},t=[[],[],[],[]],n,r;i(this);i(this.defaults);t[1].reverse();t[3].reverse();var s=this;do for(var o in s.properties){if(!(o in e)){t[2].push(e[o]={name:o,type:2,value:null})}}while(s=s.proto);var u=t[0].concat(t[1]);for(var a=0;a<u.length;a++){this.propertyMethod(u[a].name,true)}this.binds={properties:e,data:n,defs:u,required:[r],optional:pv.blend(t)}};pv.Mark.prototype.build=function(){var e=this.scene,t=pv.Mark.stack;if(!e){e=this.scene=[];e.mark=this;e.type=this.type;e.childIndex=this.childIndex;if(this.parent){e.parent=this.parent.scene;e.parentIndex=this.parent.index}}if(this.target)e.target=this.target.instances(e);if(this.binds.defs.length){var n=e.defs;if(!n)e.defs=n={};for(var r=0;r<this.binds.defs.length;r++){var i=this.binds.defs[r],s=n[i.name];if(!s||i.id>s.id){n[i.name]={id:0,value:i.type&1?i.value.apply(this,t):i.value}}}}var o=this.binds.data;o=o.type&1?o.value.apply(this,t):o.value;t.unshift(null);e.length=o.length;for(var r=0;r<o.length;r++){pv.Mark.prototype.index=this.index=r;var u=e[r];if(!u)e[r]=u={};u.data=t[0]=o[r];this.buildInstance(u)}pv.Mark.prototype.index=-1;delete this.index;t.shift();return this};pv.Mark.prototype.buildProperties=function(e,t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.value;switch(i.type){case 0:case 1:s=this.scene.defs[i.name].value;break;case 3:s=s.apply(this,pv.Mark.stack);break}e[i.name]=s}};pv.Mark.prototype.buildInstance=function(e){this.buildProperties(e,this.binds.required);if(e.visible){this.buildProperties(e,this.binds.optional);this.buildImplied(e)}};pv.Mark.prototype.buildImplied=function(e){var t=e.left;var n=e.right;var r=e.top;var i=e.bottom;var s=this.properties;var o=s.width?e.width:0;var u=s.height?e.height:0;var a=this.parent?this.parent.width():o+t+n;if(o==null){o=a-(n=n||0)-(t=t||0)}else if(n==null){if(t==null){t=n=(a-o)/2}else{n=a-o-(t=t||0)}}else if(t==null){t=a-o-n}var f=this.parent?this.parent.height():u+r+i;if(u==null){u=f-(r=r||0)-(i=i||0)}else if(i==null){if(r==null){i=r=(f-u)/2}else{i=f-u-(r=r||0)}}else if(r==null){r=f-u-i}e.left=t;e.right=n;e.top=r;e.bottom=i;if(s.width)e.width=o;if(s.height)e.height=u;if(s.textStyle&&!e.textStyle)e.textStyle=pv.Color.transparent;if(s.fillStyle&&!e.fillStyle)e.fillStyle=pv.Color.transparent;if(s.strokeStyle&&!e.strokeStyle)e.strokeStyle=pv.Color.transparent};pv.Mark.prototype.mouse=function(){var e=pv.event.pageX||0,t=pv.event.pageY||0,n=this.root.canvas();do{e-=n.offsetLeft;t-=n.offsetTop}while(n=n.offsetParent);var r=pv.Transform.identity,i=this.properties.transform?this:this.parent,s=[];do{s.push(i)}while(i=i.parent);while(i=s.pop())r=r.translate(i.left(),i.top()).times(i.transform());r=r.invert();return pv.vector(e*r.k+r.x,t*r.k+r.y)};pv.Mark.prototype.event=function(e,t){this.$handlers[e]=pv.functor(t);return this};pv.Mark.prototype.context=function(e,t,n){function u(e,t){pv.Mark.scene=e;r.index=t;if(!e)return;var n=e.mark,s=n,o=[];do{o.push(s);i.push(e[t].data);s.index=t;s.scene=e;t=e.parentIndex;e=e.parent}while(s=s.parent);for(var u=o.length-1,a=1;u>0;u--){s=o[u];s.scale=a;a*=s.scene[s.index].transform.k}if(n.children)for(var u=0,f=n.children.length;u<f;u++){s=n.children[u];s.scene=n.scene[n.index].children[u];s.scale=a}}function a(e,t){if(!e)return;var n=e.mark,r;if(n.children)for(var s=0,o=n.children.length;s<o;s++){r=n.children[s];delete r.scene;delete r.scale}r=n;do{i.pop();if(r.parent){delete r.scene;delete r.scale}delete r.index}while(r=r.parent)}var r=pv.Mark.prototype,i=pv.Mark.stack,s=pv.Mark.scene,o=r.index;a(s,o);u(e,t);try{n.apply(this,i)}finally{a(e,t);u(s,o)}};pv.Mark.dispatch=function(e,t,n){var r=t.mark,i=t.parent,s=r.$handlers[e];if(!s)return i&&pv.Mark.dispatch(e,i,t.parentIndex);r.context(t,n,function(){r=s.apply(r,pv.Mark.stack);if(r&&r.render)r.render()});return true};pv.Anchor=function(e){pv.Mark.call(this);this.target=e;this.parent=e.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(e){this.proto=e;return this};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("strokeDasharray",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7);pv.Area.prototype.buildImplied=function(e){if(e.height==null)e.height=0;if(e.width==null)e.width=0;pv.Mark.prototype.buildImplied.call(this,e)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var e=this.binds,t=e.required,n=e.optional;for(var r=0,i=n.length;r<i;r++){var s=n[r];s.fixed=s.name in pv.Area.fixed;if(s.name=="segmented"){t.push(s);n.splice(r,1);r--;i--}}this.binds.$required=t;this.binds.$optional=n};pv.Area.prototype.buildInstance=function(e){var t=this.binds;if(this.index){var n=t.fixed;if(!n){n=t.fixed=[];function r(e){return!e.fixed||(n.push(e),false)}t.required=t.required.filter(r);if(!this.scene[0].segmented)t.optional=t.optional.filter(r)}for(var i=0,s=n.length;i<s;i++){var o=n[i].name;e[o]=this.scene[0][o]}}else{t.required=t.$required;t.optional=t.$optional;t.fixed=null}pv.Mark.prototype.buildInstance.call(this,e)};pv.Area.prototype.anchor=function(e){return pv.Mark.prototype.anchor.call(this,e).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));pv.Dot.prototype.anchor=function(e){return pv.Mark.prototype.anchor.call(this,e).left(function(){var e=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return e.left;case"left":return null}return e.left+e.radius}).right(function(){var e=this.scene.target[this.index];return this.name()=="left"?e.right+e.radius:null}).top(function(){var e=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return e.top;case"top":return null}return e.top+e.radius}).bottom(function(){var e=this.scene.target[this.index];return this.name()=="top"?e.bottom+e.radius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(e){if(e.radius==null)e.radius=Math.sqrt(e.size);else if(e.size==null)e.size=e.radius*e.radius;pv.Mark.prototype.buildImplied.call(this,e)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("strokeDasharray",String).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).strokeDasharray("").interpolate("linear").eccentricity(0).tension(.7);pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(e){return pv.Area.prototype.anchor.call(this,e).textAlign(function(e){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(e){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(e){var t=e.left,n=e.right,r=e.top,i=e.bottom;if(e.width!=null||t==null&&n==null||n!=null&&t!=null){e.height=0}else{e.width=0}pv.Mark.prototype.buildImplied.call(this,e)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(e){return typeof e=="string"?document.getElementById(e):e});pv.Panel.prototype.type="panel";pv.Panel.prototype.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(e){var t=pv.Bar.prototype.anchor.call(this,e);t.parent=this;return t};pv.Panel.prototype.add=function(e){var t=new e;t.parent=this;t.root=this.root;t.childIndex=this.children.length;this.children.push(t);return t};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var e=0;e<this.children.length;e++){this.children[e].bind()}};pv.Panel.prototype.buildInstance=function(e){pv.Bar.prototype.buildInstance.call(this,e);if(!e.visible)return;if(!e.children)e.children=[];var t=this.scale*e.transform.k,n,r=this.children.length;pv.Mark.prototype.index=-1;for(var i=0;i<r;i++){n=this.children[i];n.scene=e.children[i];n.scale=t;n.build()}for(var i=0;i<r;i++){n=this.children[i];e.children[i]=n.scene;delete n.scene;delete n.scale}e.children.length=r};pv.Panel.prototype.buildImplied=function(e){if(!this.parent){var t=e.canvas;if(t){if(t.$panel!=this){t.$panel=this;while(t.lastChild)t.removeChild(t.lastChild)}var n,r;if(e.width==null){n=parseFloat(pv.css(t,"width"));e.width=n-e.left-e.right}if(e.height==null){r=parseFloat(pv.css(t,"height"));e.height=r-e.top-e.bottom}}else{var i=this.$canvas||(this.$canvas=[]);if(!(t=i[this.index])){t=i[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(t,this.$dom)}else{var s=document.body;while(s.lastChild&&s.lastChild.tagName)s=s.lastChild;if(s!=document.body)s=s.parentNode;s.appendChild(t)}}}e.canvas=t}if(!e.transform)e.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,e)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(e){this.$image=function(){var t=e.apply(this,arguments);return t==null?pv.Color.transparent:typeof t=="string"?pv.color(t):t};return this};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var e=this.binds,t=this;do{e.image=t.$image}while(!e.image&&(t=t.proto))};pv.Image.prototype.buildImplied=function(e){pv.Bar.prototype.buildImplied.call(this,e);if(!e.visible)return;if(e.imageWidth==null)e.imageWidth=e.width;if(e.imageHeight==null)e.imageHeight=e.height;if(e.url==null&&this.binds.image){var t=this.$canvas||(this.$canvas=document.createElement("canvas")),n=t.getContext("2d"),r=e.imageWidth,i=e.imageHeight,s=pv.Mark.stack,o;t.width=r;t.height=i;o=(e.image=n.createImageData(r,i)).data;s.unshift(null,null);for(var u=0,a=0;u<i;u++){s[1]=u;for(var f=0;f<r;f++){s[0]=f;var l=this.binds.image.apply(this,s);o[a++]=l.r;o[a++]=l.g;o[a++]=l.b;o[a++]=255*l.a}}s.splice(0,2)}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var e=this.sibling();return e?e.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};pv.Wedge.prototype.anchor=function(e){function t(e){return e.innerRadius||e.angle<2*Math.PI}function n(e){return(e.innerRadius+e.outerRadius)/2}function r(e){return(e.startAngle+e.endAngle)/2}return pv.Mark.prototype.anchor.call(this,e).left(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return e.left+e.outerRadius*Math.cos(r(e));case"inner":return e.left+e.innerRadius*Math.cos(r(e));case"start":return e.left+n(e)*Math.cos(e.startAngle);case"center":return e.left+n(e)*Math.cos(r(e));case"end":return e.left+n(e)*Math.cos(e.endAngle)}return e.left}).top(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return e.top+e.outerRadius*Math.sin(r(e));case"inner":return e.top+e.innerRadius*Math.sin(r(e));case"start":return e.top+n(e)*Math.sin(e.startAngle);case"center":return e.top+n(e)*Math.sin(r(e));case"end":return e.top+n(e)*Math.sin(e.endAngle)}return e.top}).textAlign(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return pv.Wedge.upright(r(e))?"right":"left";case"inner":return pv.Wedge.upright(r(e))?"left":"right"}return"center"}).textBaseline(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"start":return pv.Wedge.upright(e.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(e.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var e=this.scene.target[this.index],n=0;if(t(e))switch(this.name()){case"center":case"inner":case"outer":n=r(e);break;case"start":n=e.startAngle;break;case"end":n=e.endAngle;break}return pv.Wedge.upright(n)?n:n+Math.PI})};pv.Wedge.upright=function(e){e=e%(2*Math.PI);e=e<0?2*Math.PI+e:e;return e<Math.PI/2||e>=3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(e){if(e.angle==null)e.angle=e.endAngle-e.startAngle;else if(e.endAngle==null)e.endAngle=e.startAngle+e.angle;pv.Mark.prototype.buildImplied.call(this,e)};pv.simulation=function(e){return new pv.Simulation(e)};pv.Simulation=function(e){for(var t=0;t<e.length;t++)this.particle(e[t])};pv.Simulation.prototype.particle=function(e){e.next=this.particles;if(isNaN(e.px))e.px=e.x;if(isNaN(e.py))e.py=e.y;if(isNaN(e.fx))e.fx=0;if(isNaN(e.fy))e.fy=0;this.particles=e;return this};pv.Simulation.prototype.force=function(e){e.next=this.forces;this.forces=e;return this};pv.Simulation.prototype.constraint=function(e){e.next=this.constraints;this.constraints=e;return this};pv.Simulation.prototype.stabilize=function(e){var t;if(!arguments.length)e=3;for(var n=0;n<e;n++){var r=new pv.Quadtree(this.particles);for(t=this.constraints;t;t=t.next)t.apply(this.particles,r)}for(var i=this.particles;i;i=i.next){i.px=i.x;i.py=i.y}return this};pv.Simulation.prototype.step=function(){var e,t,n;for(e=this.particles;e;e=e.next){var r=e.px,i=e.py;e.px=e.x;e.py=e.y;e.x+=e.vx=e.x-r+e.fx;e.y+=e.vy=e.y-i+e.fy}var s=new pv.Quadtree(this.particles);for(n=this.constraints;n;n=n.next)n.apply(this.particles,s);for(e=this.particles;e;e=e.next)e.fx=e.fy=0;for(t=this.forces;t;t=t.next)t.apply(this.particles,s)};pv.Quadtree=function(e){function a(e,t,n,r,i,s){if(isNaN(t.x)||isNaN(t.y))return;if(e.leaf){if(e.p){if(Math.abs(e.p.x-t.x)+Math.abs(e.p.y-t.y)<.01){f(e,t,n,r,i,s)}else{var o=e.p;e.p=null;f(e,o,n,r,i,s);f(e,t,n,r,i,s)}}else{e.p=t}}else{f(e,t,n,r,i,s)}}function f(e,t,n,r,i,s){var o=(n+i)*.5,u=(r+s)*.5,f=t.x>=o,l=t.y>=u;e.leaf=false;switch((l<<1)+f){case 0:e=e.c1||(e.c1=new pv.Quadtree.Node);break;case 1:e=e.c2||(e.c2=new pv.Quadtree.Node);break;case 2:e=e.c3||(e.c3=new pv.Quadtree.Node);break;case 3:e=e.c4||(e.c4=new pv.Quadtree.Node);break}if(f)n=o;else i=o;if(l)r=u;else s=u;a(e,t,n,r,i,s)}var t;var n=Number.POSITIVE_INFINITY,r=n,i=Number.NEGATIVE_INFINITY,s=i;for(t=e;t;t=t.next){if(t.x<n)n=t.x;if(t.y<r)r=t.y;if(t.x>i)i=t.x;if(t.y>s)s=t.y}var o=i-n,u=s-r;if(o>u)s=r+o;else i=n+u;this.xMin=n;this.yMin=r;this.xMax=i;this.yMax=s;this.root=new pv.Quadtree.Node;for(t=e;t;t=t.next)a(this.root,t,n,r,i,s)};pv.Quadtree.Node=function(){this.leaf=true;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null};pv.Force={};pv.Force.charge=function(e){function u(t){function i(e){u(e);t.cn+=e.cn;n+=e.cn*e.cx;r+=e.cn*e.cy}var n=0,r=0;t.cn=0;if(!t.leaf){if(t.c1)i(t.c1);if(t.c2)i(t.c2);if(t.c3)i(t.c3);if(t.c4)i(t.c4)}if(t.p){t.cn+=e;n+=e*t.p.x;r+=e*t.p.y}t.cx=n/t.cn;t.cy=r/t.cn}function a(t,r,o,u,f,l){var c=t.cx-r.x,h=t.cy-r.y,p=1/Math.sqrt(c*c+h*h);if(t.leaf&&t.p!=r||(f-o)*p<s){if(p<i)return;if(p>n)p=n;var d=t.cn*p*p*p,v=c*d,m=h*d;r.fx+=v;r.fy+=m}else if(!t.leaf){var g=(o+f)*.5,y=(u+l)*.5;if(t.c1)a(t.c1,r,o,u,g,y);if(t.c2)a(t.c2,r,g,u,f,y);if(t.c3)a(t.c3,r,o,y,g,l);if(t.c4)a(t.c4,r,g,y,f,l);if(p<i)return;if(p>n)p=n;if(t.p&&t.p!=r){var d=e*p*p*p,v=c*d,m=h*d;r.fx+=v;r.fy+=m}}}var t=2,n=1/t,r=500,i=1/r,s=.9,o={};if(!arguments.length)e=-40;o.constant=function(t){if(arguments.length){e=Number(t);return o}return e};o.domain=function(e,s){if(arguments.length){t=Number(e);n=1/t;r=Number(s);i=1/r;return o}return[t,r]};o.theta=function(e){if(arguments.length){s=Number(e);return o}return s};o.apply=function(e,t){u(t.root);for(var n=e;n;n=n.next){a(t.root,n,t.xMin,t.yMin,t.xMax,t.yMax)}};return o};pv.Force.drag=function(e){var t={};if(!arguments.length)e=.1;t.constant=function(n){if(arguments.length){e=n;return t}return e};t.apply=function(t){if(e)for(var n=t;n;n=n.next){n.fx-=e*n.vx;n.fy-=e*n.vy}};return t};pv.Force.spring=function(e){var t=.1,n=20,r,i,s={};if(!arguments.length)e=.1;s.links=function(e){if(arguments.length){r=e;i=e.map(function(e){return 1/Math.sqrt(Math.max(e.sourceNode.linkDegree,e.targetNode.linkDegree))});return s}return r};s.constant=function(t){if(arguments.length){e=Number(t);return s}return e};s.damping=function(e){if(arguments.length){t=Number(e);return s}return t};s.length=function(e){if(arguments.length){n=Number(e);return s}return n};s.apply=function(s){for(var o=0;o<r.length;o++){var u=r[o].sourceNode,a=r[o].targetNode,f=u.x-a.x,c=u.y-a.y,h=Math.sqrt(f*f+c*c),p=h?1/h:1,v=e*i[o],m=t*i[o],g=(v*(h-n)+m*(f*(u.vx-a.vx)+c*(u.vy-a.vy))*p)*p,y=-g*(h?f:.01*(.5-Math.random())),b=-g*(h?c:.01*(.5-Math.random()));u.fx+=y;u.fy+=b;a.fx-=y;a.fy-=b}};return s};pv.Constraint={};pv.Constraint.collision=function(e){function a(t,u,f,l,c,h){if(!t.leaf){var p=(f+c)*.5,d=(l+h)*.5,v=d>i,m=d<o,g=p>r,y=p<s;if(v){if(t.c1&&g)a(t.c1,u,f,l,p,d);if(t.c2&&y)a(t.c2,u,p,l,c,d)}if(m){if(t.c3&&g)a(t.c3,u,f,d,p,h);if(t.c4&&y)a(t.c4,u,p,d,c,h)}}if(t.p&&t.p!=u){var b=u.x-t.p.x,w=u.y-t.p.y,E=Math.sqrt(b*b+w*w),S=n+e(t.p);if(E<S){var x=(E-S)/E*.5;b*=x;w*=x;u.x-=b;u.y-=w;t.p.x+=b;t.p.y+=w}}}var t=1,n,r,i,s,o,u={};if(!arguments.length)n=10;u.repeat=function(e){if(arguments.length){t=Number(e);return u}return t};u.apply=function(u,f){var l,c,h=-Infinity;for(l=u;l;l=l.next){c=e(l);if(c>h)h=c}for(var p=0;p<t;p++){for(l=u;l;l=l.next){c=(n=e(l))+h;r=l.x-c;s=l.x+c;i=l.y-c;o=l.y+c;a(f.root,l,f.xMin,f.yMin,f.xMax,f.yMax)}}};return u};pv.Constraint.position=function(e){var t=1,n={};if(!arguments.length)e=function(e){return e.fix};n.alpha=function(e){if(arguments.length){t=Number(e);return n}return t};n.apply=function(n){for(var r=n;r;r=r.next){var i=e(r);if(i){r.x+=(i.x-r.x)*t;r.y+=(i.y-r.y)*t;r.fx=r.fy=r.vx=r.vy=0}}};return n};pv.Constraint.bound=function(){var e={},t,n;e.x=function(e,n){if(arguments.length){t={min:Math.min(e,n),max:Math.max(e,n)};return this}return t};e.y=function(e,t){if(arguments.length){n={min:Math.min(e,t),max:Math.max(e,t)};return this}return n};e.apply=function(e){if(t)for(var r=e;r;r=r.next){r.x=r.x<t.min?t.min:r.x>t.max?t.max:r.x}if(n)for(var r=e;r;r=r.next){r.y=r.y<n.min?n.min:r.y>n.max?n.max:r.y}};return e};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=function(e,t){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[e]=true;this.propertyMethod(e,false,pv.Mark.cast[e]=t);return this};pv.Layout.Network=function(){pv.Layout.call(this);var e=this;this.$id=pv.id();(this.node=(new pv.Mark).data(function(){return e.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(e){return e.x}).top(function(e){return e.y})).parent=this;this.link=(new pv.Mark).extend(this.node).data(function(e){return[e.sourceNode,e.targetNode]}).fillStyle(null).lineWidth(function(e,t){return t.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(t){return e.add(pv.Panel).data(function(){return e.links()}).add(t).extend(this)};(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(e){return e.nodeName||e.nodeValue}).textAngle(function(e){var t=e.midAngle;return pv.Wedge.upright(t)?t:t+Math.PI}).textAlign(function(e){return pv.Wedge.upright(e.midAngle)?"left":"right"})).parent=this};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(e){return e.map(function(e,t){if(typeof e!="object")e={nodeValue:e};e.index=t;return e})}).property("links",function(e){return e.map(function(e){if(isNaN(e.linkValue))e.linkValue=isNaN(e.value)?1:e.value;return e})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(e,t){if((e.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,e,t)}};pv.Layout.Network.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);if(e.$id>=this.$id)return true;e.$id=this.$id;e.nodes.forEach(function(e){e.linkDegree=0});e.links.forEach(function(t){var n=t.linkValue;(t.sourceNode||(t.sourceNode=e.nodes[t.source])).linkDegree+=n;(t.targetNode||(t.targetNode=e.nodes[t.target])).linkDegree+=n})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(e){if(!e.links)e.links=pv.Layout.Hierarchy.links.call(this);pv.Layout.Network.prototype.buildImplied.call(this,e)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(e){return e.parentNode}).map(function(e){return{sourceNode:e,targetNode:e.parentNode,linkValue:1}})};pv.Layout.Hierarchy.NodeLink={buildImplied:function(e){function a(e){return e.parentNode?e.depth*(u-o)+o:0}function f(e){return e.parentNode?(e.breadth-.25)*2*Math.PI:0}function l(e){switch(n){case"left":return e.depth*i;case"right":return i-e.depth*i;case"top":return e.breadth*i;case"bottom":return i-e.breadth*i;case"radial":return i/2+a(e)*Math.cos(e.midAngle)}}function c(e){switch(n){case"left":return e.breadth*s;case"right":return s-e.breadth*s;case"top":return e.depth*s;case"bottom":return s-e.depth*s;case"radial":return s/2+a(e)*Math.sin(e.midAngle)}}var t=e.nodes,n=e.orient,r=/^(top|bottom)$/.test(n),i=e.width,s=e.height;if(n=="radial"){var o=e.innerRadius,u=e.outerRadius;if(o==null)o=0;if(u==null)u=Math.min(i,s)/2}for(var h=0;h<t.length;h++){var p=t[h];p.midAngle=n=="radial"?f(p):r?Math.PI/2:0;p.x=l(p);p.y=c(p);if(p.firstChild)p.midAngle+=Math.PI}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(e){return e.dx}).height(function(e){return e.dy}).innerRadius(function(e){return e.innerRadius}).outerRadius(function(e){return e.outerRadius}).startAngle(function(e){return e.startAngle}).angle(function(e){return e.angle});this.label.textAlign("center").left(function(e){return e.x+e.dx/2}).top(function(e){return e.y+e.dy/2});delete this.link},buildImplied:function(e){function f(e,t){return(e+t)/(1+t)}function l(e){switch(n){case"left":return f(e.minDepth,o)*i;case"right":return(1-f(e.maxDepth,o))*i;case"top":return e.minBreadth*i;case"bottom":return(1-e.maxBreadth)*i;case"radial":return i/2}}function c(e){switch(n){case"left":return e.minBreadth*s;case"right":return(1-e.maxBreadth)*s;case"top":return f(e.minDepth,o)*s;case"bottom":return(1-f(e.maxDepth,o))*s;case"radial":return s/2}}function h(e){switch(n){case"left":case"right":return(e.maxDepth-e.minDepth)/(1+o)*i;case"top":case"bottom":return(e.maxBreadth-e.minBreadth)*i;case"radial":return e.parentNode?(e.innerRadius+e.outerRadius)*Math.cos(e.midAngle):0}}function p(e){switch(n){case"left":case"right":return(e.maxBreadth-e.minBreadth)*s;case"top":case"bottom":return(e.maxDepth-e.minDepth)/(1+o)*s;case"radial":return e.parentNode?(e.innerRadius+e.outerRadius)*Math.sin(e.midAngle):0}}function d(e){return Math.max(0,f(e.minDepth,o/2))*(a-u)+u}function v(e){return f(e.maxDepth,o/2)*(a-u)+u}function m(e){return(e.parentNode?e.minBreadth-.25:0)*2*Math.PI}function g(e){return(e.parentNode?e.maxBreadth-e.minBreadth:1)*2*Math.PI}var t=e.nodes,n=e.orient,r=/^(top|bottom)$/.test(n),i=e.width,s=e.height,o=-t[0].minDepth;if(n=="radial"){var u=e.innerRadius,a=e.outerRadius;if(u==null)u=0;if(u)o*=2;if(a==null)a=Math.min(i,s)/2}for(var y=0;y<t.length;y++){var b=t[y];b.x=l(b);b.y=c(b);if(n=="radial"){b.innerRadius=d(b);b.outerRadius=v(b);b.startAngle=m(b);b.angle=g(b);b.midAngle=b.startAngle+b.angle/2}else{b.midAngle=r?-Math.PI/2:0}b.dx=h(b);b.dy=p(b)}}};pv.Layout.Grid=function(){pv.Layout.call(this);var e=this;(this.cell=(new pv.Mark).data(function(){return e.scene[e.index].$grid}).width(function(){return e.width()/e.cols()}).height(function(){return e.height()/e.rows()}).left(function(){return this.width()*(this.index%e.cols())}).top(function(){return this.height()*Math.floor(this.index/e.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);var t=e.rows,n=e.cols;if(typeof n=="object")t=pv.transpose(n);if(typeof t=="object"){e.$grid=pv.blend(t);e.rows=t.length;e.cols=t[0]?t[0].length:0}else{e.$grid=pv.repeat([e.data],t*n)}};pv.Layout.Stack=function(){function s(e){return function(){return n[e](this.parent.index,this.index)}}pv.Layout.call(this);var e=this,t=function(){return null},n={t:t,l:t,r:t,b:t,w:t,h:t},r,i=e.buildImplied;this.buildImplied=function(e){i.call(this,e);var s=e.layers,o=s.length,u,a=e.orient,f=/^(top|bottom)\b/.test(a),l=this.parent[f?"height":"width"](),c=[],h=[],p=[];var d=pv.Mark.stack,v={parent:{parent:this}};d.unshift(null);r=[];for(var m=0;m<o;m++){p[m]=[];h[m]=[];v.parent.index=m;d[0]=s[m];r[m]=this.$values.apply(v.parent,d);if(!m)u=r[m].length;d.unshift(null);for(var g=0;g<u;g++){d[0]=r[m][g];v.index=g;if(!m)c[g]=this.$x.apply(v,d);p[m][g]=this.$y.apply(v,d)}d.shift()}d.shift();var y;switch(e.order){case"inside-out":{var b=p.map(function(e){return pv.max.index(e)}),w=pv.range(o).sort(function(e,t){return b[e]-b[t]}),E=p.map(function(e){return pv.sum(e)}),S=0,x=0,T=[],N=[];for(var m=0;m<o;m++){var g=w[m];if(S<x){S+=E[g];T.push(g)}else{x+=E[g];N.push(g)}}y=N.reverse().concat(T);break};case"reverse":y=pv.range(o-1,-1,-1);break;default:y=pv.range(o);break}switch(e.offset){case"silohouette":{for(var g=0;g<u;g++){var v=0;for(var m=0;m<o;m++)v+=p[m][g];h[y[0]][g]=(l-v)/2}break};case"wiggle":{var v=0;for(var m=0;m<o;m++)v+=p[m][0];h[y[0]][0]=v=(l-v)/2;for(var g=1;g<u;g++){var C=0,k=0,L=c[g]-c[g-1];for(var m=0;m<o;m++)C+=p[m][g];for(var m=0;m<o;m++){var A=(p[y[m]][g]-p[y[m]][g-1])/(2*L);for(var O=0;O<m;O++){A+=(p[y[O]][g]-p[y[O]][g-1])/L}k+=A*p[y[m]][g]}h[y[0]][g]=v-=C?k/C*L:0}break};case"expand":{for(var g=0;g<u;g++){h[y[0]][g]=0;var O=0;for(var m=0;m<o;m++)O+=p[m][g];if(O){O=l/O;for(var m=0;m<o;m++)p[m][g]*=O}else{O=l/o;for(var m=0;m<o;m++)p[m][g]=O}}break};default:{for(var g=0;g<u;g++)h[y[0]][g]=0;break}}for(var g=0;g<u;g++){var v=h[y[0]][g];for(var m=1;m<o;m++){v+=p[y[m-1]][g];h[y[m]][g]=v}}var m=a.indexOf("-"),M=f?"h":"w",_=m<0?f?"l":"b":a.charAt(m+1),D=a.charAt(0);for(var P in n)n[P]=t;n[_]=function(e,t){return c[t]};n[D]=function(e,t){return h[e][t]};n[M]=function(e,t){return p[e][t]}};this.layer=(new pv.Mark).data(function(){return r[this.parent.index]}).top(s("t")).left(s("l")).right(s("r")).bottom(s("b")).width(s("w")).height(s("h"));this.layer.add=function(t){return e.add(pv.Panel).data(function(){return e.layers()}).add(t).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0};pv.Layout.Stack.prototype.x=function(e){this.$x=pv.functor(e);return this};pv.Layout.Stack.prototype.y=function(e){this.$y=pv.functor(e);return this};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(e){this.$values=pv.functor(e);return this};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(e){return e.dx}).height(function(e){return e.dy});this.label.visible(function(e){return!e.firstChild}).left(function(e){return e.x+e.dx/2}).top(function(e){return e.y+e.dy/2}).textAlign("center").textAngle(function(e){return e.dx>e.dy?0:-Math.PI/2});(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(e){return!e.firstChild})).parent=this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.padding=function(e){return this.paddingLeft(e).paddingRight(e).paddingTop(e).paddingBottom(e)};pv.Layout.Treemap.prototype.$size=function(e){return Number(e.nodeValue)};pv.Layout.Treemap.prototype.size=function(e){this.$size=pv.functor(e);return this};pv.Layout.Treemap.prototype.buildImplied=function(e){function h(e,t,n,r,i,s,o){for(var u=0,a=0;u<e.length;u++){var f=e[u];if(n){f.x=r+a;f.y=i;a+=f.dx=l(s*f.size/t);f.dy=o}else{f.x=r;f.y=i+a;f.dx=s;a+=f.dy=l(o*f.size/t)}}if(f){if(n){f.dx+=s-a}else{f.dy+=o-a}}}function p(e,t){var n=-Infinity,r=Infinity,i=0;for(var s=0;s<e.length;s++){var o=e[s].size;if(o<r)r=o;if(o>n)n=o;i+=o}i=i*i;t=t*t;return Math.max(t*n/i,i/(t*r))}function d(e,t){function b(e){var t=i==g,s=pv.sum(e,f),o=g?l(s/g):0;h(e,s,t,n,r,t?i:o,t?o:d);if(t){r+=o;d-=o}else{n+=o;i-=o}g=Math.min(i,d);return t}var n=e.x+s,r=e.y+u,i=e.dx-s-o,d=e.dy-u-a;if(c!="squarify"){h(e.childNodes,e.size,c=="slice"?true:c=="dice"?false:t&1,n,r,i,d);return}var v=[],m=Infinity,g=Math.min(i,d),y=i*d/e.size;if(e.size<=0)return;e.visitBefore(function(e){e.size*=y});var w=e.childNodes.slice();while(w.length){var E=w[w.length-1];if(!E.size){w.pop();continue}v.push(E);var y=p(v,g);if(y<=m){w.pop();m=y}else{v.pop();b(v);v.length=0;m=Infinity}}if(b(v))for(var t=0;t<v.length;t++){v[t].dy+=d}else for(var t=0;t<v.length;t++){v[t].dx+=i}}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes,r=n[0],i=pv.Mark.stack,s=e.paddingLeft,o=e.paddingRight,u=e.paddingTop,a=e.paddingBottom,f=function(e){return e.size},l=e.round?Math.round:Number,c=e.mode;i.unshift(null);r.visitAfter(function(e,n){e.depth=n;e.x=e.y=e.dx=e.dy=0;e.size=e.firstChild?pv.sum(e.childNodes,function(e){return e.size}):t.$size.apply(t,(i[0]=e,i))});i.shift();switch(e.order){case"ascending":{r.sort(function(e,t){return e.size-t.size});break};case"descending":{r.sort(function(e,t){return t.size-e.size});break};case"reverse":r.reverse();break}r.x=0;r.y=0;r.dx=e.width;r.dy=e.height;r.visitBefore(d)};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(e){function a(e){var t,n,r;if(!e.firstChild){if(t=e.previousSibling){e.prelim=t.prelim+m(e.depth,true)}}else{t=e.firstChild;n=e.lastChild;r=t;for(var i=t;i;i=i.nextSibling){a(i);r=l(i,r)}d(e);var s=.5*(t.prelim+n.prelim);if(t=e.previousSibling){e.prelim=t.prelim+m(e.depth,true);e.mod=e.prelim-s}else{e.prelim=s}}}function f(e,t,n){e.breadth=e.prelim+t;t+=e.mod;for(var r=e.firstChild;r;r=r.nextSibling){f(r,t,n)}}function l(e,t){var n=e.previousSibling;if(n){var r=e,i=e,s=n,o=e.parentNode.firstChild,u=r.mod,a=i.mod,f=s.mod,l=o.mod,d=h(s),g=c(r);while(d&&g){s=d;r=g;o=c(o);i=h(i);i.ancestor=e;var y=s.prelim+f-(r.prelim+u)+m(s.depth,false);if(y>0){p(v(s,e,t),e,y);u+=y;a+=y}f+=s.mod;u+=r.mod;l+=o.mod;a+=i.mod;d=h(s);g=c(r)}if(d&&!h(i)){i.thread=d;i.mod+=f-a}if(g&&!c(o)){o.thread=g;o.mod+=u-l;t=e}}return t}function c(e){return e.firstChild||e.thread}function h(e){return e.lastChild||e.thread}function p(e,t,n){var r=t.number-e.number;t.change-=n/r;t.shift+=n;e.change+=n/r;t.prelim+=n;t.mod+=n}function d(e){var t=0,n=0;for(var r=e.lastChild;r;r=r.previousSibling){r.prelim+=t;r.mod+=t;n+=r.change;t+=r.shift+n}}function v(e,t,n){return e.ancestor.parentNode==t.parentNode?e.ancestor:n}function m(e,t){return(t?1:s+1)/(n=="radial"?e:1)}function y(e){return n=="radial"?e.breadth/r:0}function b(e){switch(n){case"left":return e.depth;case"right":return o-e.depth;case"top":case"bottom":return e.breadth+o/2;case"radial":return o/2+e.depth*Math.cos(y(e))}}function w(e){switch(n){case"left":case"right":return e.breadth+u/2;case"top":return e.depth;case"bottom":return u-e.depth;case"radial":return u/2+e.depth*Math.sin(y(e))}}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.orient,r=e.depth,i=e.breadth,s=e.group,o=e.width,u=e.height;var g=t[0];g.visitAfter(function(e,t){e.ancestor=e;e.prelim=0;e.mod=0;e.change=0;e.shift=0;e.number=e.previousSibling?e.previousSibling.number+1:0;e.depth=t});a(g);f(g,-g.prelim,0);g.visitAfter(function(e){e.breadth*=i;e.depth*=r;e.midAngle=y(e);e.x=b(e);e.y=w(e);if(e.firstChild)e.midAngle+=Math.PI;delete e.breadth;delete e.depth;delete e.ancestor;delete e.prelim;delete e.mod;delete e.change;delete e.shift;delete e.number;delete e.thread})};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(e){function o(e,t,u){e.x=i+u++*r;e.y=s+t++*n;e.midAngle=0;for(var a=e.firstChild;a;a=a.nextSibling){t=o(a,t,u)}return t}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.breadth,r=e.depth,i=0,s=0;o(t[0],1,1)};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.radius(function(e){return e.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(e){this.$radius=typeof e=="function"?function(){return Math.sqrt(e.apply(this,arguments))}:(e=Math.sqrt(e),function(){return e});return this};pv.Layout.Pack.prototype.buildImplied=function(e){function i(e){var n=pv.Mark.stack;n.unshift(null);for(var r=0,i=e.length;r<i;r++){var s=e[r];if(!s.firstChild){s.radius=t.$radius.apply(t,(n[0]=s,n))}}n.shift()}function s(t){var n=[];for(var r=t.firstChild;r;r=r.nextSibling){if(r.firstChild)r.radius=s(r);r.n=r.p=r;n.push(r)}switch(e.order){case"ascending":{n.sort(function(e,t){return e.radius-t.radius});break};case"descending":{n.sort(function(e,t){return t.radius-e.radius});break};case"reverse":n.reverse();break}return o(n)}function o(t){function h(e){n=Math.min(e.x-e.radius,n);r=Math.max(e.x+e.radius,r);i=Math.min(e.y-e.radius,i);s=Math.max(e.y+e.radius,s)}function p(e,t){var n=e.n;e.n=t;t.p=e;t.n=n;n.p=t}function d(e,t){e.n=t;t.p=e}function v(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.radius+t.radius;return i*i-n*n-r*r>.001}var n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o,a,f,l,c;o=t[0];o.x=-o.radius;o.y=0;h(o);if(t.length>1){a=t[1];a.x=a.radius;a.y=0;h(a);if(t.length>2){f=t[2];u(o,a,f);h(f);p(o,f);o.p=f;p(f,a);a=o.n;for(var m=3;m<t.length;m++){u(o,a,f=t[m]);var g=0,y=1,b=1;for(l=a.n;l!=a;l=l.n,y++){if(v(l,f)){g=1;break}}if(g==1){for(c=o.p;c!=l.p;c=c.p,b++){if(v(c,f)){if(b<y){g=-1;l=c}break}}}if(g==0){p(o,f);a=f;h(f)}else if(g>0){d(o,l);a=l;m--}else if(g<0){d(l,a);o=l;m--}}}}var w=(n+r)/2,E=(i+s)/2,S=0;for(var m=0;m<t.length;m++){var x=t[m];x.x-=w;x.y-=E;S=Math.max(S,x.radius+Math.sqrt(x.x*x.x+x.y*x.y))}return S+e.spacing}function u(e,t,n){var r=t.radius+n.radius,i=e.radius+n.radius,s=t.x-e.x,o=t.y-e.y,u=Math.sqrt(s*s+o*o),a=(i*i+u*u-r*r)/(2*i*u),f=Math.acos(a),l=a*i,c=Math.sin(f)*i;s/=u;o/=u;n.x=e.x+l*s+c*o;n.y=e.y+l*o-c*s}function a(e,t,n,r){for(var i=e.firstChild;i;i=i.nextSibling){i.x+=e.x;i.y+=e.y;a(i,t,n,r)}e.x=t+r*e.x;e.y=n+r*e.y;e.radius*=r}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes,r=n[0];i(n);r.x=0;r.y=0;r.radius=s(r);var f=this.width(),l=this.height(),c=1/Math.max(2*r.radius/f,2*r.radius/l);a(r,f/2,l/2,c)};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(e,t){return Math.sqrt(t.linkValue)*1.5});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(e){function c(e){return e.fix?1:e.vx*e.vx+e.vy*e.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,e)){var t=e.$force;if(t){t.next=this.binds.$force;this.binds.$force=t}return}var n=this,r=e.nodes,i=e.links,s=e.iterations,o=e.width,u=e.height;for(var a=0,f;a<r.length;a++){f=r[a];if(isNaN(f.x))f.x=o/2+40*Math.random()-20;if(isNaN(f.y))f.y=u/2+40*Math.random()-20}var l=pv.simulation(r);l.force(pv.Force.drag(e.dragConstant));l.force(pv.Force.charge(e.chargeConstant).domain(e.chargeMinDistance,e.chargeMaxDistance).theta(e.chargeTheta));l.force(pv.Force.spring(e.springConstant).damping(e.springDamping).length(e.springLength).links(i));l.constraint(pv.Constraint.position());if(e.bound){l.constraint(pv.Constraint.bound().x(6,o-6).y(6,u-6))}if(s==null){l.step();l.step();var h=e.$force=this.binds.$force={next:this.binds.$force,nodes:r,min:1e-4*(i.length+1),sim:l};if(!this.$timer)this.$timer=setInterval(function(){var e=false;for(var t=n.binds.$force;t;t=t.next){if(pv.max(t.nodes,c)>t.min){t.sim.step();e=true}}if(e)n.render()},42)}else for(var a=0;a<s;a++){l.step()}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var e,t=this.buildImplied;this.buildImplied=function(n){t.call(this,n);e=/^(top|bottom)$/.test(n.orient)?"step-before":/^(left|right)$/.test(n.orient)?"step-after":"linear"};this.link.interpolate(function(){return e})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(e){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes[0],n=e.group,r,i,s=0,o=.5-n/2;var u=undefined;t.visitAfter(function(e){if(e.firstChild){e.depth=1+pv.max(e.childNodes,function(e){return e.depth})}else{if(n&&u!=e.parentNode){u=e.parentNode;s+=n}s++;e.depth=0}});r=1/s;i=1/t.depth;var u=undefined;t.visitAfter(function(e){if(e.firstChild){e.breadth=pv.mean(e.childNodes,function(e){return e.breadth})}else{if(n&&u!=e.parentNode){u=e.parentNode;o+=n}e.breadth=r*o++}e.depth=1-e.depth*i});t.visitAfter(function(e){e.minBreadth=e.firstChild?e.firstChild.minBreadth:e.breadth-r/2;e.maxBreadth=e.firstChild?e.lastChild.maxBreadth:e.breadth+r/2});t.visitBefore(function(e){e.minDepth=e.parentNode?e.parentNode.maxDepth:0;e.maxDepth=e.parentNode?e.depth+t.depth:e.minDepth+2*t.depth});t.minDepth=-i;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,e)};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(e){if(pv.Layout.Cluster.prototype.buildImplied.call(this,e))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,e)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(e){this.$size=e;return this};pv.Layout.Partition.prototype.buildImplied=function(e){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes[0],r=pv.Mark.stack,i=0;r.unshift(null);n.visitAfter(function(e,n){if(n>i)i=n;e.size=e.firstChild?pv.sum(e.childNodes,function(e){return e.size}):t.$size.apply(t,(r[0]=e,r))});r.shift();switch(e.order){case"ascending":n.sort(function(e,t){return e.size-t.size});break;case"descending":n.sort(function(e,t){return t.size-e.size});break}var s=1/i;n.minBreadth=0;n.breadth=.5;n.maxBreadth=1;n.visitBefore(function(e){var t=e.minBreadth,n=e.maxBreadth-t;for(var r=e.firstChild;r;r=r.nextSibling){r.minBreadth=t;r.maxBreadth=t+=r.size/e.size*n;r.breadth=(t+r.minBreadth)/2}});n.visitAfter(function(e,t){e.minDepth=(t-1)*s;e.maxDepth=e.depth=t*s});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,e)};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(e){if(pv.Layout.Partition.prototype.buildImplied.call(this,e))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,e)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var e,t,n,r=this.buildImplied;this.buildImplied=function(i){r.call(this,i);t=i.directed;e=i.orient=="radial"?"linear":"polar";n=i.orient=="right"||i.orient=="top"};this.link.data(function(e){var r=e.sourceNode,i=e.targetNode;return n!=(t||r.breadth<i.breadth)?[r,i]:[i,r]}).interpolate(function(){return e})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(e){this.$sort=e;return this};pv.Layout.Arc.prototype.buildImplied=function(e){function a(e){switch(n){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(e-.25)*2*Math.PI}}function f(e){switch(n){case"top":case"bottom":return e*s;case"left":return 0;case"right":return s;case"radial":return s/2+u*Math.cos(a(e))}}function l(e){switch(n){case"top":return 0;case"bottom":return o;case"left":case"right":return e*o;case"radial":return o/2+u*Math.sin(a(e))}}if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.orient,r=this.$sort,i=pv.range(t.length),s=e.width,o=e.height,u=Math.min(s,o)/2;if(r)i.sort(function(e,n){return r(t[e],t[n])});for(var c=0;c<t.length;c++){var h=t[i[c]],p=h.breadth=(c+.5)/t.length;h.x=f(p);h.y=l(p);h.midAngle=a(p)}};pv.Layout.Horizon=function(){pv.Layout.call(this);var e=this,t,n,r,i,s,o,u=this.buildImplied;this.buildImplied=function(e){u.call(this,e);t=e.bands;n=e.mode;r=Math.round((n=="color"?.5:1)*e.height);i=e.backgroundStyle;s=pv.ramp(i,e.negativeStyle).domain(0,t);o=pv.ramp(i,e.positiveStyle).domain(0,t)};var t=(new pv.Panel).data(function(){return pv.range(t*2)}).overflow("hidden").height(function(){return r}).top(function(e){return n=="color"?(e&1)*r:0}).fillStyle(function(e){return e?null:i});this.band=(new pv.Mark).top(function(e,t){return n=="mirror"&&t&1?(t+1>>1)*r:null}).bottom(function(e,t){return n=="mirror"?t&1?null:(t+1>>1)*-r:(t&1||-1)*(t+1>>1)*r}).fillStyle(function(e,t){return(t&1?s:o)((t>>1)+1)});this.band.add=function(n){return e.add(pv.Panel).extend(t).add(n).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var e=this,t,n,r=e.buildImplied;this.buildImplied=function(e){r.call(this,e);t=e.$rollup.nodes;n=e.$rollup.links};this.node.data(function(){return t}).size(function(e){return e.nodes.length*20});this.link.interpolate("polar").eccentricity(.8);this.link.add=function(t){return e.add(pv.Panel).data(function(){return n}).add(t).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(e){this.$x=pv.functor(e);return this};pv.Layout.Rollup.prototype.y=function(e){this.$y=pv.functor(e);return this};pv.Layout.Rollup.prototype.buildImplied=function(e){function l(e){return s[e]+","+o[e]}if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.links,r=e.directed,i=t.length,s=[],o=[],u=0,a={},f={};var c=pv.Mark.stack,h={parent:this};c.unshift(null);for(var p=0;p<i;p++){h.index=p;c[0]=t[p];s[p]=this.$x.apply(h,c);o[p]=this.$y.apply(h,c)}c.shift();for(var p=0;p<t.length;p++){var d=l(p),v=a[d];if(!v){v=a[d]=pv.extend(t[p]);v.index=u++;v.x=s[p];v.y=o[p];v.nodes=[]}v.nodes.push(t[p])}for(var p=0;p<n.length;p++){var m=n[p].sourceNode,g=n[p].targetNode,y=a[l(m.index)],b=a[l(g.index)],w=!r&&y.index>b.index,E=w?b.index+","+y.index:y.index+","+b.index,S=f[E];if(!S){S=f[E]={sourceNode:y,targetNode:b,linkValue:0,links:[]}}S.links.push(n[p]);S.linkValue+=n[p].linkValue}e.$rollup={nodes:pv.values(a),links:pv.values(f)}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var e=this,t,n,r,i,s,o=e.buildImplied;this.buildImplied=function(e){o.call(this,e);t=e.nodes.length;n=e.width/t;r=e.height/t;i=e.$matrix.labels;s=e.$matrix.pairs};this.link.data(function(){return s}).left(function(){return n*(this.index%t)}).top(function(){return r*Math.floor(this.index/t)}).width(function(){return n}).height(function(){return r}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(e){return e.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return i}).left(function(){return this.index&1?n*((this.index>>1)+.5):0}).top(function(){return this.index&1?0:r*((this.index>>1)+.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(e){this.$sort=e;return this};pv.Layout.Matrix.prototype.buildImplied=function(e){if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.links,r=this.$sort,i=t.length,s=pv.range(i),o=[],u=[],a={};e.$matrix={labels:o,pairs:u};if(r)s.sort(function(e,n){return r(t[e],t[n])});for(var f=0;f<i;f++){for(var l=0;l<i;l++){var c=s[f],h=s[l],p={row:f,col:l,sourceNode:t[c],targetNode:t[h],linkValue:0};u.push(a[c+"."+h]=p)}}for(var f=0;f<i;f++){var c=s[f];o.push(t[c],t[c])}for(var f=0;f<n.length;f++){var d=n[f],v=d.sourceNode.index,m=d.targetNode.index,g=d.linkValue;a[v+"."+m].linkValue+=g;if(!e.directed)a[m+"."+v].linkValue+=g}};pv.Layout.Bullet=function(){pv.Layout.call(this);var e=this,t=e.buildImplied,n=e.x=pv.Scale.linear(),r,i,s,o,u;this.buildImplied=function(e){t.call(this,u=e);r=e.orient;i=/^left|right$/.test(r);s=pv.ramp("#bbb","#eee").domain(0,Math.max(1,u.ranges.length-1));o=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,u.measures.length-1))};(this.range=new pv.Mark).data(function(){return u.ranges}).reverse(true).left(function(){return r=="left"?0:null}).top(function(){return r=="top"?0:null}).right(function(){return r=="right"?0:null}).bottom(function(){return r=="bottom"?0:null}).width(function(e){return i?n(e):null}).height(function(e){return i?null:n(e)}).fillStyle(function(){return s(this.index)}).antialias(false).parent=e;(this.measure=new pv.Mark).extend(this.range).data(function(){return u.measures}).left(function(){return r=="left"?0:i?null:this.parent.width()/3.25}).top(function(){return r=="top"?0:i?this.parent.height()/3.25:null}).right(function(){return r=="right"?0:i?null:this.parent.width()/3.25}).bottom(function(){return r=="bottom"?0:i?this.parent.height()/3.25:null}).fillStyle(function(){return o(this.index)}).parent=e;(this.marker=new pv.Mark).data(function(){return u.markers}).left(function(e){return r=="left"?n(e):i?null:this.parent.width()/2}).top(function(e){return r=="top"?n(e):i?this.parent.height()/2:null}).right(function(e){return r=="right"?n(e):null}).bottom(function(e){return r=="bottom"?n(e):null}).strokeStyle("black").shape("bar").angle(function(){return i?0:Math.PI/2}).parent=e;(this.tick=new pv.Mark).data(function(){return n.ticks(7)}).left(function(e){return r=="left"?n(e):null}).top(function(e){return r=="top"?n(e):null}).right(function(e){return r=="right"?n(e):i?null:-6}).bottom(function(e){return r=="bottom"?n(e):i?-8:null}).height(function(){return i?6:null}).width(function(){return i?null:6}).parent=e};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);var t=this.parent[/^left|right$/.test(e.orient)?"width":"height"]();e.maximum=e.maximum||pv.max([].concat(e.ranges,e.markers,e.measures));this.x.domain(0,e.maximum).range(0,t)};pv.Behavior={};pv.Behavior.drag=function(){function s(s){t=this.index;e=this.scene;var o=this.mouse();r=((n=s).fix=pv.vector(s.x,s.y)).minus(o);i={x:this.parent.width()-(s.dx||0),y:this.parent.height()-(s.dy||0)};e.mark.context(e,t,function(){this.render()});pv.Mark.dispatch("dragstart",e,t)}function o(){if(!e)return;e.mark.context(e,t,function(){var e=this.mouse();n.x=n.fix.x=Math.max(0,Math.min(r.x+e.x,i.x));n.y=n.fix.y=Math.max(0,Math.min(r.y+e.y,i.y));this.render()});pv.Mark.dispatch("drag",e,t)}function u(){if(!e)return;n.fix=null;e.mark.context(e,t,function(){this.render()});pv.Mark.dispatch("dragend",e,t);e=null}var e,t,n,r,i;pv.listen(window,"mousemove",o);pv.listen(window,"mouseup",u);return s};pv.Behavior.point=function(e){function o(e,t){var n=e[t],s={cost:Infinity};for(var u=0,a=n.visible&&n.children.length;u<a;u++){var f=n.children[u],l=f.mark,c;if(l.type=="panel"){l.scene=f;for(var h=0,p=f.length;h<p;h++){l.index=h;c=o(f,h);if(c.cost<s.cost)s=c}delete l.scene;delete l.index}else if(l.$handlers.point){var d=l.mouse();for(var h=0,p=f.length;h<p;h++){var v=f[h],m=d.x-v.left-(v.width||0)/2,g=d.y-v.top-(v.height||0)/2,y=r*m*m+i*g*g;if(y<s.cost){s.distance=m*m+g*g;s.cost=y;s.scene=f;s.index=h}}}}return s}function u(){var e=o(this.scene,this.index);if(e.cost==Infinity||e.distance>s)e=null;if(t){if(e&&t.scene==e.scene&&t.index==e.index)return;pv.Mark.dispatch("unpoint",t.scene,t.index)}if(t=e){pv.Mark.dispatch("point",e.scene,e.index);pv.listen(this.root.canvas(),"mouseout",a)}}function a(e){if(t&&!pv.ancestor(this,e.relatedTarget)){pv.Mark.dispatch("unpoint",t.scene,t.index);t=null}}var t,n=null,r=1,i=1,s=arguments.length?e*e:900;u.collapse=function(e){if(arguments.length){n=String(e);switch(n){case"y":r=1;i=0;break;case"x":r=0;i=1;break;default:r=1;i=1;break}return u}return n};return u};pv.Behavior.select=function(){function i(i){t=this.index;e=this.scene;r=this.mouse();n=i;n.x=r.x;n.y=r.y;n.dx=n.dy=0;pv.Mark.dispatch("selectstart",e,t)}function s(){if(!e)return;e.mark.context(e,t,function(){var e=this.mouse();n.x=Math.max(0,Math.min(r.x,e.x));n.y=Math.max(0,Math.min(r.y,e.y));n.dx=Math.min(this.width(),Math.max(e.x,r.x))-n.x;n.dy=Math.min(this.height(),Math.max(e.y,r.y))-n.y;this.render()});pv.Mark.dispatch("select",e,t)}function o(){if(!e)return;pv.Mark.dispatch("selectend",e,t);e=null}var e,t,n,r;pv.listen(window,"mousemove",s);pv.listen(window,"mouseup",o);return i};pv.Behavior.resize=function(e){function s(s){n=this.index;t=this.scene;i=this.mouse();r=s;switch(e){case"left":i.x=r.x+r.dx;break;case"right":i.x=r.x;break;case"top":i.y=r.y+r.dy;break;case"bottom":i.y=r.y;break}pv.Mark.dispatch("resizestart",t,n)}function o(){if(!t)return;t.mark.context(t,n,function(){var e=this.mouse();r.x=Math.max(0,Math.min(i.x,e.x));r.y=Math.max(0,Math.min(i.y,e.y));r.dx=Math.min(this.parent.width(),Math.max(e.x,i.x))-r.x;r.dy=Math.min(this.parent.height(),Math.max(e.y,i.y))-r.y;this.render()});pv.Mark.dispatch("resize",t,n)}function u(){if(!t)return;pv.Mark.dispatch("resizeend",t,n);t=null}var t,n,r,i;pv.listen(window,"mousemove",o);pv.listen(window,"mouseup",u);return s};pv.Behavior.pan=function(){function o(){t=this.index;e=this.scene;r=pv.vector(pv.event.pageX,pv.event.pageY);n=this.transform();i=1/(n.k*this.scale);if(s){s={x:(1-n.k)*this.width(),y:(1-n.k)*this.height()}}}function u(){if(!e)return;e.mark.context(e,t,function(){var e=(pv.event.pageX-r.x)*i,t=(pv.event.pageY-r.y)*i,o=n.translate(e,t);if(s){o.x=Math.max(s.x,Math.min(0,o.x));o.y=Math.max(s.y,Math.min(0,o.y))}this.transform(o).render()});pv.Mark.dispatch("pan",e,t)}function a(){e=null}var e,t,n,r,i,s;o.bound=function(e){if(arguments.length){s=Boolean(e);return this}return Boolean(s)};pv.listen(window,"mousemove",u);pv.listen(window,"mouseup",a);return o};pv.Behavior.zoom=function(e){function n(){var n=this.mouse(),r=pv.event.wheel*e,i=this.transform().translate(n.x,n.y).scale(r<0?1e3/(1e3-r):(1e3+r)/1e3).translate(-n.x,-n.y);if(t){i.k=Math.max(1,i.k);i.x=Math.max((1-i.k)*this.width(),Math.min(0,i.x));i.y=Math.max((1-i.k)*this.height(),Math.min(0,i.y))}this.transform(i).render();pv.Mark.dispatch("zoom",this.scene,this.index)}var t;if(!arguments.length)e=1/48;n.bound=function(e){if(arguments.length){t=Boolean(e);return this}return Boolean(t)};return n};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(e){return{x:e.lng/180,y:e.lat>85?1:e.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(e.lat)/2))/Math.PI}},invert:function(e){return{lng:e.x*180,lat:pv.degrees(2*Math.atan(Math.exp(e.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(e){return{x:e.lng/180,y:Math.sin(pv.radians(e.lat))}},invert:function(e){return{lng:e.x*180,lat:pv.degrees(Math.asin(e.y))}}},sinusoidal:{project:function(e){return{x:pv.radians(e.lng)*Math.cos(pv.radians(e.lat))/Math.PI,y:e.lat/90}},invert:function(e){return{lng:pv.degrees(e.x*Math.PI/Math.cos(e.y*Math.PI/2)),lat:e.y*90}}},aitoff:{project:function(e){var t=pv.radians(e.lng),n=pv.radians(e.lat),r=Math.acos(Math.cos(n)*Math.cos(t/2));return{x:2*(r?Math.cos(n)*Math.sin(t/2)*r/Math.sin(r):0)/Math.PI,y:2*(r?Math.sin(n)*r/Math.sin(r):0)/Math.PI}},invert:function(e){var t=e.x*Math.PI/2,n=e.y*Math.PI/2;return{lng:pv.degrees(t/Math.cos(n)),lat:pv.degrees(n)}}},hammer:{project:function(e){var t=pv.radians(e.lng),n=pv.radians(e.lat),r=Math.sqrt(1+Math.cos(n)*Math.cos(t/2));return{x:2*Math.SQRT2*Math.cos(n)*Math.sin(t/2)/r/3,y:Math.SQRT2*Math.sin(n)/r/1.5}},invert:function(e){var t=e.x*3,n=e.y*1.5,r=Math.sqrt(1-t*t/16-n*n/4);return{lng:pv.degrees(2*Math.atan2(r*t,2*(2*r*r-1))),lat:pv.degrees(Math.asin(r*n))}}},identity:{project:function(e){return{x:e.lng/180,y:e.lat/90}},invert:function(e){return{lng:e.x*180,lat:e.y*90}}}};pv.Geo.scale=function(e){function l(e){if(!a||e.lng!=a.lng||e.lat!=a.lat){a=e;var t=c(e);f={x:s(t.x),y:o(t.y)}}return f}function c(e){var t={lng:e.lng-u.lng,lat:e.lat};return i.project(t)}function h(e){var t=i.invert(e);t.lng+=u.lng;return t}var t={x:0,y:0},n={x:1,y:1},r=[],i=pv.Geo.projections.identity,s=pv.Scale.linear(-1,1).range(0,1),o=pv.Scale.linear(-1,1).range(1,0),u={lng:0,lat:0},a,f;l.x=function(e){return l(e).x};l.y=function(e){return l(e).y};l.ticks={lng:function(e){var t,n;if(r.length>1){var i=pv.Scale.linear();if(e==undefined)e=10;t=i.domain(r,function(e){return e.lat}).ticks(e);n=i.domain(r,function(e){return e.lng}).ticks(e)}else{t=pv.range(-80,81,10);n=pv.range(-180,181,10)}return n.map(function(e){return t.map(function(t){return{lat:t,lng:e}})})},lat:function(e){return pv.transpose(l.ticks.lng(e))}};l.invert=function(e){return h({x:s.invert(e.x),y:o.invert(e.y)})};l.domain=function(e,t){if(arguments.length){r=e instanceof Array?arguments.length>1?pv.map(e,t):e:Array.prototype.slice.call(arguments);if(r.length>1){var n=r.map(function(e){return e.lng});var i=r.map(function(e){return e.lat});u={lng:(pv.max(n)+pv.min(n))/2,lat:(pv.max(i)+pv.min(i))/2};var f=r.map(c);s.domain(f,function(e){return e.x});o.domain(f,function(e){return e.y})}else{u={lng:0,lat:0};s.domain(-1,1);o.domain(-1,1)}a=null;return this}return r};l.range=function(e,r){if(arguments.length){if(typeof e=="object"){t={x:Number(e.x),y:Number(e.y)};n={x:Number(r.x),y:Number(r.y)}}else{t={x:0,y:0};n={x:Number(e),y:Number(r)}}s.range(t.x,n.x);o.range(n.y,t.y);a=null;return this}return[t,n]};l.projection=function(e){if(arguments.length){i=typeof e=="string"?pv.Geo.projections[e]||pv.Geo.projections.identity:e;return this.domain(r)}return e};l.by=function(e){function t(){return l(e.apply(this,arguments))}for(var n in l)t[n]=l[n];return t};if(arguments.length)l.projection(e);return l}